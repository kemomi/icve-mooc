var WhatyMediaPlayer=function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=10)}([function(e,t,r){"use strict";function n(){}function i(e,t){return(new Date).toLocaleString()+" "+e.toUpperCase()+" "+t}function a(e){var t=self.console[e];return t?function(){for(var r=arguments.length,n=Array(r),a=0;a<r;a++)n[a]=arguments[a];n.length>=2&&(n[0]=i(e,n[0])),t.apply(self.console,n)}:n}Object.defineProperty(t,"__esModule",{value:!0});var o={warn:n,info:n},s={};!function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];t.forEach(function(e){s[e]=a(e)})}("info","warn","error"),o.error=s.error;var u=(t.enableLogs=function(e){t.logger=u=!0===e?s:o},t.logger=o)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={};!function(){var e=self.navigator.userAgent.toLowerCase(),t=/(edge)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(firefox)[ \/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(iemobile)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[],r=/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(android)/.exec(e)||/(windows)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||[],i={browser:t[5]||t[3]||t[1]||"",version:t[2]||t[4]||"0",majorVersion:t[4]||t[2]||"0",platform:r[0]||""},a={};if(i.browser){a[i.browser]=!0;var o=i.majorVersion.split(".");a.version={major:parseInt(i.majorVersion,10),string:i.version},o.length>1&&(a.version.minor=parseInt(o[1],10)),o.length>2&&(a.version.build=parseInt(o[2],10))}i.platform&&(a[i.platform]=!0),(a.chrome||a.opr||a.safari)&&(a.webkit=!0),(a.rv||a.iemobile)&&(a.rv&&delete a.rv,i.browser="msie",a.msie=!0),a.edge&&(delete a.edge,i.browser="msedge",a.msedge=!0),a.opr&&(i.browser="opera",a.opera=!0),a.safari&&a.android&&(i.browser="android",a.android=!0),(a.iphone||a.ipad||a.ipod)&&(a.ios=!0),a.name=i.browser,a.platform=i.platform;for(var s in n)n.hasOwnProperty(s)&&delete n[s];n=Object.freeze(a)}(),t.default=n},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(4),s=n(o),u=r(14),l=n(u),f=r(0),c=r(1),d=n(c),h="WhatyMediaPlayerBase",p=function(){function e(){var t=this;i(this,e),this._init(),this._mediaElement=null,this.onStateChanged=null,this._mediaEvent={playing:function(){t._isPlaying=!0,t._notifyStateChanged()},waiting:function(){t._isPlaying=!1,t._checkPlayingRef=null,t._notifyStateChanged()},pause:function(){t._notifyStateChanged()},play:function(){t._isEverStart=!0,t._notifyStateChanged()},ended:function(){t._notifyStateChanged()},loadedmetadata:function(){t._onCanSeek()},error:function(e){f.logger.error(h,"media error:"+e.target.error.code),t._handleError()}}}return a(e,[{key:"prepare",value:function(){return this.dataSource&&this._mediaElement?this.metaLoader?void f.logger.info("prepare already running"):(this._metaLoader=new l.default(this),void this._setState(s.default.Preparing)):void f.logger.error("please set dataSource and mediaElement before run prepare!")}},{key:"setCurrentQuality",value:function(e,t){return e!==parseInt(e)?void f.logger.error(h,"quality should be integer,get "+e):this._qualityLevels?void(e>=0&&e<this._qualityLevels.length?(this._currentQuality!==e&&(this._currentQuality=e,this._onSetCurrentQuality()),t&&localStorage.setItem("com.whaty.mediaplayer.qualitylabel",this._qualityLevels[this._currentQuality].label)):f.logger.error(h,"bad quality level "+e+"!")):void f.logger.error(h,"quality can only be set after prepared")}},{key:"play",value:function(){if(this._mediaElement)try{this._mediaElement.play()}catch(e){f.logger.error(e)}}},{key:"pause",value:function(){this._mediaElement&&(this._mediaElement.pause(),this._notifyStateChanged())}},{key:"load",value:function(){this._mediaElement&&this._mediaElement.load()}},{key:"reset",value:function(){if(this._metaLoader&&this._metaLoader.stop(),this._mediaElement)for(var e in this._mediaEvent)this._mediaElement.removeEventListener(e,this._mediaEvent[e]);this._checkPlayingTimer&&(self.clearTimeout(this._checkPlayingTimer),this._checkPlayingTimer=null),this._init(),this._mediaElement=null,this.onStateChanged=null}},{key:"_init",value:function(){this._state=s.default.Idle,this._meta=null,this._currentQuality=0,this._qualityLevels=null,this._servers=null,this._dataSource=null,this._metaLoader=null,this._isPlaying=!1,this._isLoadingStart=!1,this._lastNotiyfyState=null,this._lastNotiyfyWidth=null,this._lastNotiyfyHeight=null,this._pendingSeek=null,this._canseek=!1,this._isEverStart=!1,this._checkPlayingRef=null,this._checkPlayingTimer=null}},{key:"_onGetMeta",value:function(e){if(f.logger.info(h,"meta.json Received!"),this._meta=e,this._parseMeta(e)){for(var t=this._qualityLevels,r=0;r<t.length;r++){"360P"===t[r].label&&(this._currentQuality=r)}var n=localStorage.getItem("com.whaty.mediaplayer.qualitylabel");if(n)for(var i=0;i<t.length;i++){var a=t[i];a.label===n&&(this._currentQuality=i)}this._addMediaEvents(),this._setState(s.default.Prepared),this._mediaElement&&(!this._mediaElement.autoplay&&this._mediaElement.paused||(this._isEverStart=!0),"none"===this._mediaElement.preload&&!this._mediaElement.autoplay&&this._mediaElement.paused||this._doAttachMedia())}else this._onLoadMetaFailed()}},{key:"_parseMeta",value:function(e){try{if("string"==typeof e.duration?e.duration=parseFloat(e.duration):"number"!=typeof e.duration&&(e.duration=null),!e.duration)throw new Error("need duration!");if(!e.levels)throw new Error("need levels!");for(var t in e.levels){var r=e.levels[t];switch(r.key=t,t.toLowerCase()){case"0p":case"op":r.label="\u97f3\u9891";break;case"ori":r.label="\u539f\u753b";break;default:r.label=t.toUpperCase()}if(!r.list)throw new Error("need level list!");for(var n=0,i=0;i<r.list.length;i++){var a=r.list[i];if(!a.filename||0!=a.start&&!a.start)throw new Error("need seg.start and seg.filename!");"string"==typeof a.start&&(a.start=parseFloat(a.start)),"string"==typeof a.end&&(a.end=parseFloat(a.end)),a.size&&(n+=a.size)}n>0&&(r.size=n)}var o=[];for(var s in e.levels)o.push(e.levels[s]);o.sort(function(e,t){return e.height?t.height?t.height-e.height:-1:1}),this._qualityLevels=o}catch(e){return f.logger.error(h,"meta.json has error!"),f.logger.error(e),!1}return!0}},{key:"_setState",value:function(e){this._state!==e&&(this._state=e,this._notifyStateChanged())}},{key:"_addMediaEvents",value:function(){var e=this;if(d.default.msedge||d.default.msie||d.default.ios){this._mediaEvent.seeking=function(){e._checkPlayingRef=null},function t(){e._mediaElement&&(!e._canseek||e._mediaElement.paused||e._mediaElement.ended?e._checkPlayingRef=null:(e._isPlaying?e._checkPlayingRef&&e._mediaElement.currentTime-e._checkPlayingRef<.1&&(e._isPlaying=!1,e._notifyStateChanged()):e._checkPlayingRef&&e._mediaElement.currentTime-e._checkPlayingRef>.1&&(e._isPlaying=!0,e._notifyStateChanged()),e._checkPlayingRef=e._mediaElement.currentTime)),e._checkPlayingTimer=self.setTimeout(t,200)}()}for(var t in this._mediaEvent)this._mediaElement.addEventListener(t,this._mediaEvent[t])}},{key:"_onSetCurrentQuality",value:function(){}},{key:"_handleError",value:function(){}},{key:"_onCanSeek",value:function(){this._canseek=!0,null!==this._pendingSeek&&(f.logger.info(h,"Do pendingSeek to "+this._pendingSeek),d.default.safari?this._mediaElement.currentTime=Math.max(this._pendingSeek,.001):this._mediaElement.currentTime=this._pendingSeek,this._pendingSeek=null)}},{key:"_notifyStateChanged",value:function(e){if(this._lastNotiyfyState!==this.state){this._lastNotiyfyState=this.state;try{this.onStateChanged&&this.onStateChanged(e)}catch(e){f.logger.error(e)}}}},{key:"_onLoadMetaFailed",value:function(){this._setState(s.default.PreparingError)}},{key:"_doAttachMedia",value:function(){}},{key:"_onSeeking",value:function(){}},{key:"state",get:function(){return this._state===s.default.Prepared&&this._isLoadingStart?this._mediaElement.ended?s.default.PlayBackCompleted:this._mediaElement.paused?s.default.Paused:this._isPlaying?s.default.Playing:s.default.Buffering:this._state}},{key:"dataSource",get:function(){return this._dataSource},set:function(e){this.state!==s.default.Idle?f.logger.error("dataSource can only be set when player state is idle"):this._dataSource=e}},{key:"servers",get:function(){return this._servers},set:function(e){this._servers=e}},{key:"mediaElement",get:function(){return this._mediaElement},set:function(e){if(this._mediaElement)return void f.logger.error("mediaElement was already set,ignore!");this._mediaElement=e}},{key:"currentQuality",get:function(){return this._currentQuality},set:function(e){this.setCurrentQuality(e,!1)}},{key:"qualityLevels",get:function(){if(this._qualityLevels){for(var e=[],t=0;t<this._qualityLevels.length;t++){var r=this._qualityLevels[t];e.push(r.label)}return e}return[]}},{key:"buffered",get:function(){if(this._mediaElement)return this._mediaElement.buffered}},{key:"duration",get:function(){return this._meta?this._meta.duration:this._mediaElement?this._mediaElement.duration:NaN}},{key:"volume",get:function(){return this._mediaElement?this._mediaElement.volume:1},set:function(e){this._mediaElement&&(this._mediaElement.volume=e)}},{key:"muted",get:function(){return!!this._mediaElement&&this._mediaElement.muted},set:function(e){this._mediaElement&&(this._mediaElement.muted=e)}},{key:"currentTime",get:function(){return this._pendingSeek?this._pendingSeek:this._mediaElement?this._mediaElement.currentTime:0},set:function(e){if(!this._canseek)return f.logger.info(h,"Can not set currentTime now, try to do pendingSeek after loadedmetadata!"),this._pendingSeek=e,void this._onSeeking();if(this._mediaElement)try{this._mediaElement.currentTime=e}catch(e){f.logger.error(e)}}},{key:"bufferedPosition",get:function(){if(this._pendingSeek)return this._pendingSeek;if(this._mediaElement){var e=this._mediaElement.currentTime;if(!this._canseek)return e;for(var t=this._mediaElement.buffered,r=t.length-1;r>=0;r--){var n=t.start(r),i=t.end(r);if(d.default.safari&&this.videoHeight>0){if(e+.08>=n&&e<i)return i}else if(e>=n&&e<i)return i}return e}return 0}},{key:"playbackRate",get:function(){return this._mediaElement?this._mediaElement.playbackRate:1},set:function(e){this._mediaElement&&(this._mediaElement.playbackRate=e)}},{key:"downloadSpeed",get:function(){return 0}},{key:"videoWidth",get:function(){return this._mediaElement?this._mediaElement.videoWidth:-1}},{key:"videoHeight",get:function(){return this._mediaElement?this._mediaElement.videoHeight:-1}},{key:"controls",set:function(e){this._mediaElement&&(this._mediaElement.controls=!!e)}},{key:"fullScreen",set:function(e){if(this._mediaElement)if(e=!!e)try{var t=this._mediaElement.webkitEnterFullscreen||this._mediaElement.webkitEnterFullScreen;t&&t.apply(this._mediaElement)}catch(e){f.logger.error(e)}else{var r=this._mediaElement.webkitExitFullscreen||this._mediaElement.webkitExitFullScreen;r&&r.apply(this._mediaElement)}},get:function(){return!!this._mediaElement&&this._mediaElement.webkitDisplayingFullscreen}}]),e}();t.default=p},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(0),o="BaseSegLoader",s=function(){function e(t,r,i,a){var o=this;n(this,e),this.url=t,this.start=r,this.end=i,this.timeout=a,this.status=0,this.receivedLength=0,this.loadStartTime=Date.now(),this.isTimeout=!1,this.requestAbort=!1,this.isDone=!1,this.requestUrl=this.url,this.ttfbTimeout=1e4,this.ttfbTime=-1,this.timer=self.setTimeout(function(){o._loop()},1e3),this.onDataArrival=null,this.onError=null,this.onComplete=null,this.onFileLengthKnown=null}return i(e,[{key:"abort",value:function(){this.onDataArrival=null,this.onError=null,this.onComplete=null,this.requestAbort=!0,this.onFileLengthKnown=null,this.timer&&(self.clearTimeout(this.timer),this.timer=null)}},{key:"_loop",value:function(){var e=this;this.requestAbort||this.isDone||(this._checkTimeout(),this.timer=self.setTimeout(function(){e._loop()},1e3))}},{key:"_checkTimeout",value:function(){if(this.loadStartTime&&!this.isTimeOut){var e=!1,t=Date.now();this.ttfbTime<=0?this.receivedLength>0?this.ttfbTime=t:this.loadStartTime+this.ttfbTimeout<t&&(e=!0):this.ttfbTime+this.timeout<t?e=!0:this.ttfbTime+1e4<t&&this.end-this.start>0&&this.receivedLength*this.timeout<(this.end-this.start)*(t-this.ttfbTime)&&(e=!0),e&&(this.isTimeout=!0,this._reportError())}}},{key:"_reportError",value:function(){this.onError&&(this.isTimeout?a.logger.info(o,this.requestUrl+" load timeout!"):a.logger.info(o,this.requestUrl+" load failed!"),this.onError(),this.onError=null),this.requestAbort||this.abort()}},{key:"_onGetRangeHeader",value:function(e){try{if(e){var t=parseInt(e.split("/")[1]);isNaN(t)||this.onFileLengthKnown&&this.onFileLengthKnown(t)}}catch(e){a.logger.warn(e)}}},{key:"params",get:function(){return"PlayerVersion=HTML5_1.0.17-dirty"}}]),e}();t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(5),i=function(e){return e&&e.__esModule?e:{default:e}}(n),a=Object.freeze({Idle:(0,i.default)("idle"),Preparing:(0,i.default)("preparing"),PreparingError:(0,i.default)("preparingError"),Prepared:(0,i.default)("prepared"),Buffering:(0,i.default)("buffering"),Playing:(0,i.default)("playing"),Paused:(0,i.default)("paused"),PlayBackCompleted:(0,i.default)("playBackCompleted")});t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=self.Symbol;n||(n=function(e){return e}),t.default=n},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){i=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw a}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(15),u=n(s),l=r(16),f=n(l),c=r(0),d=r(7),h=n(d),p=function(){function e(t,r){var n=this;i(this,e),this.dataSource=t,this.servers=r,this.isStopped=!1,this.isDone=!1,this.loader=null,self.setTimeout(function(){n.loop()},0)}return o(e,[{key:"searchServer",value:function(e){var t=this;if(this.servers)this.httpServer=new f.default(this.servers);else{var r=u.default.getFullSearchUrl(this.getFormatPath(e)),n=a(r,2),i=n[0],o=n[1],s=this.loader=new h.default(i,4e3);this.loader.onSuccess=function(e){if(e.servers)try{for(var r=[],n=0;n<e.servers.length;n++){var i=e.servers[n];r.push(i)}t.httpServer=new f.default(r),t.loop_async()}catch(e){u.default.nextServer(o),c.logger.error(e)}t.loader=null},this.loader.onError=function(){u.default.nextServer(o),s.isTimeout&&t.loop_async(),t.loader=null},this.loader.open()}}},{key:"nextServer",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.httpServer&&(e&&this.httpServer.addCurrentServerToBlackList(),this.httpServer.isLastServer()?this.httpServer=null:this.httpServer.nextServer())}},{key:"loop",value:function(){var e=this;this.isStopped||this.isDone||(this.doSomeWork(),self.setTimeout(function(){e.loop()},1e3))}},{key:"loop_async",value:function(){var e=this;self.setTimeout(function(){e.doSomeWork()},0)}},{key:"doSomeWork",value:function(){this.isStopped||this.isDone||this.loader||this.doWork()}},{key:"stop",value:function(){this.isStopped=!0,this.loader&&this.loader.abort()}},{key:"setDone",value:function(){this.isDone=!0}},{key:"getFormatPath",value:function(e){for(var t=e.split("/"),r=[],n=0;n<t.length;n++){var i=t[n];""!=i&&"."!=i&&(".."==i?r.pop():r.push(i))}return r.join("/")}}]),e}();t.default=p},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(0),o=function(){function e(t,r){n(this,e),this.url=t,this.timeout=r,this.isAbort=!1}return i(e,[{key:"open",value:function(){var e=this,t=new XMLHttpRequest;t.open("GET",this.url),this.timeout&&(t.timeout=this.timeout),t.onloadend=function(){if(e.status=t.status,200===t.status)try{var r=JSON.parse(t.responseText);return void(e.onSuccess&&(e.onSuccess(r),e.onError=null,e.onSuccess=null))}catch(e){a.logger.error(e)}e.onError&&(e.isTimeout?a.logger.info(e.url+" load timeout!"):a.logger.info(e.url+" load failed!"),e.onError(),e.onError=null,e.onSuccess=null)},t.ontimeout=function(){e.isTimeout=!0},this.client=t,t.send()}},{key:"abort",value:function(){this.onError=null,this.onSuccess=null,this.isAbort=!0,this.client&&(this.client.abort(),this.client=null)}}]),e}();t.default=o},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(26),s=n(o),u=r(0),l=r(28),f=n(l),c="FlvTag",d=function(){function e(){i(this,e)}return a(e,[{key:"parseScriptData",value:function(){return s.default.parseScriptData(this.buffer.buffer,e.TAG_HEADER_BYTE_COUNT,this.dataSize)}},{key:"tagType",get:function(){return this.buffer[0]}},{key:"timeStamp",get:function(){var e=0;return e+=this.buffer[4]<<16,e+=this.buffer[5]<<8,e+=this.buffer[6],e+=this.buffer[7]<<24}},{key:"hasError",get:function(){return this.prevTagSize+e.PREV_TAG_BYTE_COUNT!==this.buffer.byteLength}},{key:"dataSize",get:function(){var e=0;return e+=this.buffer[1]<<16,e+=this.buffer[2]<<8,e+=this.buffer[3]}},{key:"prevTagSize",get:function(){var t=0,r=e.TAG_HEADER_BYTE_COUNT+this.dataSize;return t+=this.buffer[r]<<24,t+=this.buffer[r+1]<<16,t+=this.buffer[r+2]<<8,t+=this.buffer[r+3]}},{key:"avcPacketType",get:function(){return this.buffer.byteLength<e.TAG_HEADER_BYTE_COUNT+2?(u.logger.error(c,"not enough data!"),-1):this.buffer[e.TAG_HEADER_BYTE_COUNT+1]}},{key:"isKeyFrame",get:function(){return this.buffer.byteLength<e.TAG_HEADER_BYTE_COUNT+1?(u.logger.error(c,"not enough data!"),-1):16==(240&this.buffer[e.TAG_HEADER_BYTE_COUNT])}},{key:"avcCompositionTimeOffset",get:function(){if(this.buffer.byteLength<e.TAG_HEADER_BYTE_COUNT+5)return u.logger.error(c,"not enough data!"),0;var t=0;return t+=this.buffer[e.TAG_HEADER_BYTE_COUNT+2]<<16,t+=this.buffer[e.TAG_HEADER_BYTE_COUNT+3]<<8,t+=this.buffer[e.TAG_HEADER_BYTE_COUNT+4]}},{key:"avcCodec",get:function(){if(this.buffer.byteLength<e.TAG_HEADER_BYTE_COUNT+9)return u.logger.error(c,"not enough data!"),"avc1.640029";for(var t=this.buffer.subarray(e.TAG_HEADER_BYTE_COUNT+6,e.TAG_HEADER_BYTE_COUNT+9),r="avc1.",n=0;n<3;n++){var i=t[n].toString(16);i.length<2&&(i="0"+i),r+=i}return r}},{key:"aVCDecoderConfigurationRecord",get:function(){return this.buffer.subarray(e.TAG_HEADER_BYTE_COUNT+5,e.TAG_HEADER_BYTE_COUNT+this.dataSize)}},{key:"sps",get:function(){if(this.buffer.byteLength<e.TAG_HEADER_BYTE_COUNT+13)return u.logger.error(c,"not enough data to get sps!"),null;var t=(this.buffer[e.TAG_HEADER_BYTE_COUNT+11]<<8)+this.buffer[e.TAG_HEADER_BYTE_COUNT+12];if(this.buffer.byteLength<e.TAG_HEADER_BYTE_COUNT+13+t)return u.logger.error(c,"not enough data to get sps!"),null;var r=this.buffer.subarray(e.TAG_HEADER_BYTE_COUNT+13,e.TAG_HEADER_BYTE_COUNT+13+t);return f.default.parseSPS(r)}},{key:"avcData",get:function(){return this.buffer.subarray(e.TAG_HEADER_BYTE_COUNT+5,e.TAG_HEADER_BYTE_COUNT+this.dataSize)}},{key:"isAACSequenceHeader",get:function(){return this.buffer.byteLength<e.TAG_HEADER_BYTE_COUNT+2?(u.logger.error(c,"not enough data!"),!1):0===this.buffer[e.TAG_HEADER_BYTE_COUNT+1]}},{key:"audioObjectType",get:function(){return this.buffer.byteLength<e.TAG_HEADER_BYTE_COUNT+3?(u.logger.error(c,"not enough data!"),5):(248&this.buffer[e.TAG_HEADER_BYTE_COUNT+2])>>3}},{key:"samplingIndex",get:function(){return this.buffer.byteLength<e.TAG_HEADER_BYTE_COUNT+4?(u.logger.error(c,"not enough data!"),7):(7&this.buffer[e.TAG_HEADER_BYTE_COUNT+2])<<1|this.buffer[e.TAG_HEADER_BYTE_COUNT+3]>>7}},{key:"soundRate",get:function(){if(this.buffer.byteLength<e.TAG_HEADER_BYTE_COUNT+4)return u.logger.error(c,"not enough data!"),22050;switch(((7&this.buffer[e.TAG_HEADER_BYTE_COUNT+2])<<1)+((128&this.buffer[e.TAG_HEADER_BYTE_COUNT+3])>>7)){case 0:return 96e3;case 1:return 88200;case 2:return 64e3;case 3:return 48e3;case 4:return 44100;case 5:return 32e3;case 6:return 24e3;case 7:return 22050;case 8:return 16e3;case 9:return 12e3;case 10:return 11025;case 11:return 8e3;case 12:return 7350;default:return u.logger.error(c,"unkown audio sample rate!"),22050}}},{key:"channelConfig",get:function(){return this.buffer.byteLength<e.TAG_HEADER_BYTE_COUNT+4?(u.logger.error(c,"not enough data!"),2):(120&this.buffer[e.TAG_HEADER_BYTE_COUNT+3])>>3}},{key:"channelCount",get:function(){return this.buffer.byteLength<e.TAG_HEADER_BYTE_COUNT+4?(u.logger.error(c,"not enough data!"),2):(120&this.buffer[e.TAG_HEADER_BYTE_COUNT+3])>>3==1?1:2}},{key:"frameLength",get:function(){return this.buffer.byteLength<e.TAG_HEADER_BYTE_COUNT+4?(u.logger.error(c,"not enough data!"),1024):2!=this.audioObjectType?this.buffer.byteLength<e.TAG_HEADER_BYTE_COUNT+6?1024:0==(2&this.buffer[e.TAG_HEADER_BYTE_COUNT+4])?1024:960:0==(4&this.buffer[e.TAG_HEADER_BYTE_COUNT+3])?1024:960}},{key:"audioSpecificConfig",get:function(){for(var t=[],r=e.TAG_HEADER_BYTE_COUNT+2;r<e.TAG_HEADER_BYTE_COUNT+this.dataSize;r++)t.push(this.buffer[r]);return t}},{key:"aacData",get:function(){return this.buffer.subarray(e.TAG_HEADER_BYTE_COUNT+2,e.TAG_HEADER_BYTE_COUNT+this.dataSize)}}],[{key:"PREV_TAG_BYTE_COUNT",get:function(){return 4}},{key:"TAG_HEADER_BYTE_COUNT",get:function(){return 11}},{key:"TAG_TYPE_AUDIO",get:function(){return 8}},{key:"TAG_TYPE_VIDEO",get:function(){return 9}},{key:"TAG_TYPE_SCRIPTDATAOBJECT",get:function(){return 18}},{key:"AVC_PACKET_TYPE_SEQUENCE_HEADER",get:function(){return 0}},{key:"AVC_PACKET_TYPE_NALU",get:function(){return 1}},{key:"AVC_PACKET_TYPE_END_OF_SEQUENCE",get:function(){return 2}}]),e}();t.default=d},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(6),u=function(e){return e&&e.__esModule?e:{default:e}}(s),l=function(e){function t(e){n(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.dataSource,e.servers));return r.player=e,r}return a(t,e),o(t,[{key:"doWork",value:function(){if(this.httpServer){var e=this.httpServer.getFullHttpUrl(this.getFormatPath(this.dataSource+"/../"+this.player._mp4FileName));this.player._onGetMp4Url(e),this.setDone()}else this.searchServer(this.dataSource+"/../"+this.player._mp4FileName)}}]),t}(u.default);t.default=l},function(e,t,r){"use strict";e.exports=r(11).default},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(12),s=n(o),u=r(33),l=n(u),f=r(34),c=n(f),d=r(2),h=n(d),p=r(4),y=n(p),_=r(0),m=r(37),v=n(m),g=r(38),b=n(g),S=r(5),E=n(S),k=(0,E.default)("InternalPlayer"),T=function(){function e(t){i(this,e),this.aliPlayerLoaded=!1;var r=this;if(t&&"aliplayer"===t.toLocaleLowerCase()){if(!this.aliPlayerLoaded){(0,b.default)("https://g.alicdn.com/de/prismplayer/2.8.2/skins/default/aliplayer-min.css");var n=new v.default("https://g.alicdn.com/de/prismplayer/2.8.2/aliplayer-min.js");n.addEventListener("ERROR",function(){r.aliPlayerLoaded=!0}),n.addEventListener("COMPLETE",function(){r.aliPlayerLoaded=!0}),n.load()}this.initAliPlayer()}else s.default.isSupported?this[k]=new s.default:l.default.isSupported?this[k]=new l.default:(_.logger.error("This.browser is not Supported!"),this[k]=new h.default)}return a(e,null,[{key:"Version",get:function(){return"1.0.17-dirty"}},{key:"isSupportMSE",get:function(){return s.default.isSupported}},{key:"isSupportHtml5Video",get:function(){return l.default.isSupported}},{key:"isSupportHls",get:function(){return l.default.isSupportHls}},{key:"isSupportCors",get:function(){return"withCredentials"in new XMLHttpRequest}},{key:"isSupported",get:function(){return e.isSupportCors&&(s.default.isSupported||l.default.isSupported)}},{key:"States",get:function(){return y.default}},{key:"enableLogs",set:function(e){(0,_.enableLogs)(e)}}]),a(e,[{key:"initAliPlayer",value:function(){this[k]=new c.default}},{key:"prepare",value:function(){this[k].prepare()}},{key:"setCurrentQuality",value:function(e,t){this[k].setCurrentQuality(e,t)}},{key:"play",value:function(){this[k].play()}},{key:"pause",value:function(){this[k].pause()}},{key:"load",value:function(){this[k].load()}},{key:"reset",value:function(){this[k].reset()}},{key:"state",get:function(){return this[k].state}},{key:"dataSource",get:function(){return this[k].dataSource},set:function(e){this[k].dataSource=e}},{key:"servers",get:function(){return this[k].servers},set:function(e){this[k].servers=e}},{key:"mediaElement",get:function(){return this[k].mediaElement},set:function(e){this[k].mediaElement=e}},{key:"currentQuality",get:function(){return this[k].currentQuality},set:function(e){this[k].currentQuality=e}},{key:"qualityLevels",get:function(){return this[k].qualityLevels}},{key:"buffered",get:function(){return this[k].buffered}},{key:"duration",get:function(){return this[k].duration}},{key:"volume",get:function(){return this[k].volume},set:function(e){this[k].volume=e}},{key:"muted",get:function(){return this[k].muted},set:function(e){this[k].muted=e}},{key:"currentTime",get:function(){return this[k].currentTime},set:function(e){if(isNaN(e))return void _.logger.error("currentTime can't be set with "+e);this[k].currentTime=parseFloat(e)}},{key:"bufferedPosition",get:function(){return this[k].bufferedPosition}},{key:"playbackRates",set:function(e){this[k].playbackRates=e}},{key:"playbackRate",get:function(){return this[k].playbackRate},set:function(e){this[k].playbackRate=e}},{key:"downloadSpeed",get:function(){return this[k].downloadSpeed}},{key:"videoWidth",get:function(){return this[k].videoWidth}},{key:"videoHeight",get:function(){return this[k].videoHeight}},{key:"controls",set:function(e){this[k].controls=e}},{key:"fullScreen",set:function(e){this[k].fullScreen=e},get:function(){return this[k].fullScreen}},{key:"onStateChanged",get:function(){return this[k].onStateChanged},set:function(e){this[k].onStateChanged=e}}]),e}();t.default=T},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,n)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(n)},u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=r(13),f=n(l),c=r(2),d=n(c),h=r(0),p=r(18),y=n(p),_=r(1),m=n(_),v="WhatyMediaPlayerMse",g=function(e){function t(){i(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e._mseMediaEvent={play:function(){e._recoverIfError(),e._initMseCtl()},seeking:function(){e._recoverIfError(),e._onSeeking()},timeupdate:function(){e._checkTransmuxer()}};var r=m.default.chrome&&(m.default.version.major<50||50===m.default.version.major&&m.default.version.build<2661);return e._alwaysSeekKeyframe=!!(r||m.default.msedge||m.default.msie),e}return o(t,e),u(t,null,[{key:"isSupported",get:function(){return!(m.default.android&&/mqqbrowser/i.test(navigator.userAgent)&&!(/microMessenger/i.test(navigator.userAgent)||/qq/i.test(navigator.userAgent)&&/v1_and_sq/i.test(navigator.userAgent)))&&(!(m.default.android&&m.default.chrome&&m.default.version.major<53)&&(window.MediaSource&&"function"==typeof window.MediaSource.isTypeSupported&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.640029,mp4a.40.5"')))}}]),u(t,[{key:"reset",value:function(){if(this._transmuxer&&(this._transmuxer.stop(),this._transmuxer=null),this._msectl&&(this._msectl.destroy(),this._msectl=null),this._mediaElement)for(var e in this._mseMediaEvent)this._mediaElement.removeEventListener(e,this._mseMediaEvent[e]);s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"reset",this).call(this)}},{key:"_init",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_init",this).call(this),this._msectl=null,this._transmuxer=null,this._sourceOpen=!1,this._changingQuality=!1,this._lastFlvHeader=null,this._pendingSeekToKeyFrame=null}},{key:"_addMediaEvents",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_addMediaEvents",this).call(this);for(var e in this._mseMediaEvent)this._mediaElement.addEventListener(e,this._mseMediaEvent[e])}},{key:"_onSetCurrentQuality",value:function(){this._msectl&&(this._msectl.clearSegments(),this._changingQuality=!0),this._closeTransmuxer(),this._pendingSeekToKeyFrame=null,this._checkTransmuxer()}},{key:"_reInitTransmuxer",value:function(){this._transmuxer&&(this._closeTransmuxer(),this._msectl&&this._msectl.clearPendingEos(),this._initTransmuxer())}},{key:"_checkTransmuxer",value:function(){if(this._msectl&&!this._msectl.hasPendingRemoveRanges()&&!this._msectl.isUpdating()&&(this._changingQuality&&(this._changingQuality=!1,m.default.safari?Math.round(1e3*this.currentTime)<1e3*this.currentTime?this.currentTime=Math.max(0,this.currentTime-1e-4):this.currentTime=this.currentTime+1e-4:this.currentTime=this.currentTime,h.logger.info(v,"Reseeking to "+this.currentTime+" for changing qualityLevel")),this._sourceOpen&&!this._transmuxer&&this._mediaElement&&!this._mediaElement.error&&this._initTransmuxer(),this._transmuxer&&this._mediaElement)){var e=!1;this._transmuxer.bufferedPosition+1<this.bufferedPosition&&(this._msectl.clearPendingSegments(),e=!0),(Math.round(1e3*this._transmuxer.startTime)>Math.round(1e3*this.bufferedPosition)||this._transmuxer.bufferedPosition+1<this.currentTime||!this._msectl.hasPendingSegments()&&this._transmuxer.bufferedPosition>this.bufferedPosition+10)&&(e=!0),e&&(h.logger.info(v,"Recreate transmuxer"),h.logger.info(v,"transmuxer startTime: "+this._transmuxer.startTime),h.logger.info(v,"transmuxer bufferedPosition: "+this._transmuxer.bufferedPosition),h.logger.info(v,"media currentTime: "+this.currentTime),h.logger.info(v,"media bufferedPosition: "+this.bufferedPosition),this._reInitTransmuxer())}}},{key:"_closeTransmuxer",value:function(){this._transmuxer&&(this._transmuxer.stop(),this._transmuxer=null)}},{key:"_initTransmuxer",value:function(){var e=this;this._mediaElement&&this._qualityLevels&&!this._transmuxer&&(this._isLoadingStart=!0,h.logger.info(v,"Start loading segment data from seconds: "+this.bufferedPosition),this._transmuxer=new y.default(this),this._transmuxer.onFlvHeader=function(t){if(!e._lastFlvHeader||e._lastFlvHeader.hasVideo===t.hasVideo&&e._lastFlvHeader.hasAudio===t.hasAudio)return void(e._lastFlvHeader=t);h.logger.info(v,"video tracks changed to hasVideo:"+t.hasVideo+", hasAudio:"+t.hasAudio),e._lastFlvHeader=t,e._reAttachMedia()},this._transmuxer.onInitSegment=function(t){e._msectl.appendInitSegment(t)},this._transmuxer.onMediaSegment=function(t){e._msectl.appendMediaSegment(t)},this._transmuxer.onComplete=function(){e._msectl.endOfStream()},this._transmuxer.onMetaComplete=function(){null!==e._pendingSeekToKeyFrame&&e._doReseekToKeyFrame()},this._notifyStateChanged())}},{key:"_reAttachMedia",value:function(){var e=this._mediaElement.paused,t=this.currentTime;this._msectl&&(this._msectl.destroy(),this._msectl=null),this._canseek=!1,this._changingQuality=!1,this._sourceOpen=!1,this._initMseCtl(),this.currentTime=t,e?this._isEverStart&&this._mediaElement.pause():this._mediaElement.play()}},{key:"_handleError",value:function(){this._closeTransmuxer()}},{key:"_recoverIfError",value:function(){this._mediaElement&&this._mediaElement.error&&this._msectl&&(this._closeTransmuxer(),this._reAttachMedia())}},{key:"_initMseCtl",value:function(){var e=this;this._msectl||(this._msectl=new f.default,this._msectl.onSourceClose=function(){e._sourceOpen=!1,e._closeTransmuxer(),(m.default.msedge||m.default.msie)&&(e._msectl&&(e._msectl.destroy(),e._msectl=null),e._canseek=!1,e._doAttachMedia())},this._msectl.onSourceOpen=function(){e.duration&&(e._msectl.duration=e.duration),e._sourceOpen=!0,e._checkTransmuxer()},this._msectl.onSourceEnd=function(){e._notifyStateChanged()},this._msectl.onSourceBufferUpdateEnd=function(){e._checkTransmuxer()},this._msectl.attachMediaElement(this._mediaElement))}},{key:"_doAttachMedia",value:function(){this._initMseCtl()}},{key:"_onSeeking",value:function(){if(this._mediaElement){var e=this.currentTime;h.logger.info(v,"seeking to "+e),m.default.safari&&e<.001?(h.logger.info(v,"currentTime: "+e+", do reseeking to 0.001"),this.currentTime=.001):this._alwaysSeekKeyframe&&(this._pendingSeekToKeyFrame=e,this._doReseekToKeyFrame()),this._checkTransmuxer()}}},{key:"_doReseekToKeyFrame",value:function(){var e=this._getNearestKeyframeTime(this._pendingSeekToKeyFrame);if(null!==e){var t=e.time,r=e.flvHeader,n=this._pendingSeekToKeyFrame;if(this._pendingSeekToKeyFrame=null,!r.hasVideo)return;if(n+.1>t&&n<t+5e-4)return;if((m.default.msedge||m.default.msie)&&n>t&&n<t+.02)return;h.logger.info(v,"seek to key frame "+t),this.currentTime=t}}},{key:"_getNearestKeyframeTime",value:function(e){if(this._qualityLevels){var t=this._qualityLevels[this._currentQuality].list,r=y.default.seekFlvSegment(t,e),n=t[r];if(n.mediaInfo&&n.mediaInfo.onMetaData&&n.mediaInfo.onMetaData.keyframes&&n.mediaInfo.onMetaData.keyframes.times){var i=n.mediaInfo.onMetaData.keyframes.times,a=y.default.getNearestKeyframe(i,e-n.start);return{time:Math.round(1e3*(i[a]+n.start))/1e3,flvHeader:n.mediaInfo.flvHeader}}}return null}},{key:"downloadSpeed",get:function(){return this._transmuxer?this._transmuxer.downloadSpeed:0}}]),t}(d.default);t.default=g},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(0),o=function(){function e(){var t=this;n(this,e),this.TAG="MSEController",this._mediaSourceEvents={sourceopen:function(){a.logger.info(t.TAG,"MediaSource onSourceOpen"),t._onSourceOpen()},sourceended:function(){t.onSourceEnd&&t.onSourceEnd(),a.logger.info(t.TAG,"MediaSource onSourceEnded")},sourceclose:function(){a.logger.info(t.TAG,"MediaSource onSourceClose"),t._onSourceClose()}},this._sourceBufferEvents={updateend:function(){t.onSourceBufferUpdateEnd&&t.onSourceBufferUpdateEnd(),t._doWork()},error:function(){a.logger.error(t.TAG,"SourceBuffer Error")}},this._init(),this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElement=null,this.onSourceClose=null,this.onSourceOpen=null,this.onSourceBufferUpdateEnd=null}return i(e,[{key:"attachMediaElement",value:function(e){if(this._mediaSource)return void a.logger.error(this.TAG,"MediaSource has been attached to an HTMLMediaElement!");var t=this._mediaSource=new window.MediaSource;for(var r in this._mediaSourceEvents)t.addEventListener(r,this._mediaSourceEvents[r]);var n=e.paused;this._mediaElement=e,this._mediaSourceObjectURL=self.URL.createObjectURL(this._mediaSource),e.src=this._mediaSourceObjectURL,!n&&e.paused&&e.play()}},{key:"appendInitSegment",value:function(e){if(this._pendingSegments.push(e),!this._mediaSource||"open"!==this._mediaSource.readyState)return void this._pendingInitSourceBuffer.push(e);this._initSourceBuffer(e),this._doWork()}},{key:"appendMediaSegment",value:function(e){this._pendingSegments.push(e),this._doWork()}},{key:"endOfStream",value:function(){this._hasPendingEos=!0,this._doWork()}},{key:"clearPendingEos",value:function(){this._hasPendingEos=!1}},{key:"clearPendingSegments",value:function(){this._pendingSegments=[]}},{key:"clearSegments",value:function(){if(this._hasPendingEos=!1,this._pendingSegments=[],"closed"!==this._mediaSource.readyState){var e=this._sourceBuffer;if(e){if("open"===this._mediaSource.readyState)try{e.abort()}catch(e){a.logger.error(e)}for(var t=0;t<e.buffered.length;t++){var r=e.buffered.start(t),n=e.buffered.end(t);this._pendingRemoveRanges.push({start:r,end:n})}e.updating||this._doRemoveRanges()}}}},{key:"_initSourceBuffer",value:function(e){var t=e,r=t.container+";codecs="+t.codec;if(a.logger.info(this.TAG,"Received Initialization Segment, mimeType: "+r),r!==this._mimeType){if(this._mimeType)a.logger.info(this.TAG,"Notice: mimeType changed, origin: "+this._mimeType+", target: "+r);else try{var n=this._sourceBuffer=this._mediaSource.addSourceBuffer(r);for(var i in this._sourceBufferEvents)n.addEventListener(i,this._sourceBufferEvents[i])}catch(e){return void a.logger.error(e)}this._mimeType=r}}},{key:"_onSourceOpen",value:function(){if(this._mediaSource&&"open"===this._mediaSource.readyState){if(this._pendingInitSourceBuffer.length>0)for(var e=this._pendingInitSourceBuffer;e.length;){var t=e.shift();this._initSourceBuffer(t)}this._doWork(),this.onSourceOpen&&this.onSourceOpen()}}},{key:"_onSourceClose",value:function(){this._init(),this.onSourceClose&&this.onSourceClose()}},{key:"hasPendingSegments",value:function(){return this._pendingSegments.length>0}},{key:"hasPendingRemoveRanges",value:function(){return this._pendingRemoveRanges.length>0}},{key:"isUpdating",value:function(){return this._sourceBuffer&&this._sourceBuffer.updating}},{key:"_doWork",value:function(){this._doUpdateDuration(),this._doRemoveRanges(),this._doAppendSegments(),this._doEndOfStream()}},{key:"_doUpdateDuration",value:function(){if(!isNaN(this._pendingDuration)){var e=this._mediaSource,t=this._sourceBuffer;if(!(!e||"closed"===e.readyState||t&&t.updating)){if("ended"===e.readyState)return void(this._pendingDuration=NaN);(isNaN(e.duration)||e.duration===1/0||e.duration<this._pendingDuration)&&(e.duration=this._pendingDuration),this._pendingDuration=NaN}}}},{key:"_doRemoveRanges",value:function(){if(this.hasPendingRemoveRanges()&&this._mediaSource&&"closed"!==this._mediaSource.readyState){var e=this._sourceBuffer;if(e&&!e.updating)for(var t=this._pendingRemoveRanges;t.length&&!e.updating;){var r=t.shift();try{e.remove(r.start,r.end)}catch(e){t.unshift(r),a.logger.warn(e)}}}}},{key:"_doAppendSegments",value:function(){var e=this;if(this.hasPendingSegments()&&this._mediaSource&&"closed"!==this._mediaSource.readyState){var t=this._sourceBuffer;if(t&&!t.updating){var r=this._pendingSegments,n=r.shift();try{return void this._sourceBuffer.appendBuffer(n.data)}catch(t){this._pendingSegments.unshift(n),this._timer||(this._timer=self.setTimeout(function(){e._timer=null,e._doWork()},5e3)),t.code===DOMException.QUOTA_EXCEEDED_ERR?(a.logger.warn(this.TAG,t.message),this._onBufferFull()):(a.logger.error(this.TAG,"sourcebuffer appended error!"),a.logger.error(this.TAG,t.message))}}}}},{key:"_onBufferFull",value:function(){if(this._mediaElement&&this._sourceBuffer){for(var e=this._sourceBuffer,t=this._mediaElement.currentTime,r=0;r<e.buffered.length;r++){var n=e.buffered.start(r),i=e.buffered.end(r);if(n<t-60&&i-n>1)return this._pendingRemoveRanges.push({start:n,end:Math.min(i,n+10)}),void this._doWork()}for(var a=e.buffered.length-1;a>=0;a--){var o=e.buffered.start(a),s=e.buffered.end(a);if(s>t+60&&s-o>1)return this._pendingRemoveRanges.push({start:s-10,end:s}),void this._doWork()}}}},{key:"_doEndOfStream",value:function(){if(this._hasPendingEos){var e=this._mediaSource;if(e&&"closed"!==e.readyState){if("ended"===e.readyState)return void(this._hasPendingEos=!1);var t=this._sourceBuffer;t&&t.updating||this.hasPendingSegments()||(this._hasPendingEos=!1,e.endOfStream())}}}},{key:"_init",value:function(){this._mimeType=null,this._sourceBuffer=null,this._pendingSegments=[],this._pendingRemoveRanges=[],this._pendingInitSourceBuffer=[],this._pendingDuration=NaN,this._hasPendingEos=!1,this._timer&&self.clearTimeout(this._timer),this._timer=null}},{key:"_detachMediaElement",value:function(){if(this._mediaSource){var e=this._mediaSource,t=this._sourceBuffer;if(t){if("closed"!==e.readyState)try{e.removeSourceBuffer(t)}catch(e){a.logger.error(e)}for(var r in this._sourceBufferEvents)t.removeEventListener(r,this._sourceBufferEvents[r])}for(var n in this._mediaSourceEvents)e.removeEventListener(n,this._mediaSourceEvents[n])}this._init(),this._mediaSource=null,this._mediaElement&&(this._mediaElement.removeAttribute("src"),this._mediaElement.load(),this._mediaElement=null),this._mediaSourceObjectURL&&(URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)}},{key:"destroy",value:function(){this.onSourceOpen=null,this.onSourceClose=null,this.onSourceEnd=null,this.onSourceBufferUpdateEnd=null,this._init(),this._detachMediaElement()}},{key:"duration",set:function(e){this._pendingDuration=e,this._doWork()}}]),e}();t.default=o},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=r(6),l=n(u),f=r(7),c=n(f),d=function(e){function t(e){i(this,t);var r=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.dataSource,e.servers));return r.http404times=0,r.player=e,r}return o(t,e),s(t,[{key:"doWork",value:function(){var e=this;if(this.httpServer){var t=this.httpServer.getFullHttpUrl(this.getFormatPath(this.dataSource)),r=this.loader=new c.default(t,3e3);this.loader.onSuccess=function(t){e.player&&e.player._onGetMeta(t),e.httpServer.removeCurrentServerFromBlackList(),e.loader=null,e.setDone()},this.loader.onError=function(){404===r.status?(e.http404times+=1,e.http404times>3?(e.player&&e.player._onLoadMetaFailed(),e.setDone()):(e.nextServer(!1),e.loop_async())):(e.nextServer(),r.isTimeout&&e.loop_async()),e.loader=null},this.loader.open()}else this.searchServer(this.dataSource)}}]),t}(l.default);t.default=d},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});for(var i=(function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}()),a=r(0),o=["https://1-searchvideo.webtrn.cn/search_servers2","https://2-searchvideo.webtrn.cn/search_servers2","https://3-searchvideo.webtrn.cn/search_servers2"],s=0,u=localStorage.getItem("com.whaty.mediaplayer.current_search_server"),l=0;l<o.length;l++){if(u==o[l]){s=l;break}}var f=function(){function e(){n(this,e)}return i(e,null,[{key:"getFullSearchUrl",value:function(e){return[o[s]+"?path="+encodeURIComponent(e)+"&PlayerVersion=HTML5_1.0.17-dirty",o[s]]}},{key:"nextServer",value:function(e){if(e===o[s]){s=(s+1)%o.length;try{localStorage.setItem("com.whaty.mediaplayer.current_search_server",o[s])}catch(e){a.logger.warn(e)}}}}]),e}();t.default=f},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(17),o=function(e){return e&&e.__esModule?e:{default:e}}(a),s=function(){function e(t){n(this,e),this.http_servers=[];for(var r=[],i=0;i<t.length;i++){var a=t[i];o.default.isServerIn(a)?r.push(a):this.http_servers.push(a)}this.http_servers=this.http_servers.concat(r),this.current_http_server=0}return i(e,[{key:"getFullHttpUrl",value:function(e){return this.http_servers[this.current_http_server]+""+encodeURI(e)}},{key:"nextServer",value:function(){this.current_http_server=(this.current_http_server+1)%this.http_servers.length}},{key:"isLastServer",value:function(){return this.current_http_server+1==this.http_servers.length}},{key:"removeCurrentServerFromBlackList",value:function(){o.default.removeServer(this.http_servers[this.current_http_server])}},{key:"addCurrentServerToBlackList",value:function(){o.default.addServer(this.http_servers[this.current_http_server])}}]),e}();t.default=s},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(){var e=null,t=null;for(var r in y){var n=y[r];null!=t&&t<n||(e=r,t=n)}null!=e&&(l.logger.info(_,e+" was expired from blacklist"),delete y[e])}function a(){if(h+6e5<Date.now()){h=Date.now();for(var e in y){var t=y[e];if(d+t<Date.now())return i(),void o()}}}function o(){if(p+1e3<Date.now()){for(p=Date.now();y.size>c;)i();try{localStorage.setItem(f,JSON.stringify(y))}catch(e){l.logger.warn(e)}}}Object.defineProperty(t,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=r(0),f="com.whaty.mediaplayer.black_server_list",c=100,d=72e5,h=0,p=Date.now(),y={},_="BlackServerList",m=function(){function e(){n(this,e)}return u(e,null,[{key:"addServer",value:function(e){l.logger.info(_,"Add "+e+" to blacklist"),y[e]=Date.now(),o()}},{key:"removeServer",value:function(e){e in y&&(l.logger.info(_,"Remove "+e+" from blacklist"),delete y[e],o())}},{key:"isServerIn",value:function(e){return a(),e in y}}]),e}();try{var v=JSON.parse(localStorage.getItem(f));for(var g in v){var b=v[g];(void 0===b?"undefined":s(b))==s(Date.now())&&(void 0===g?"undefined":s(g))==s("ss")&&(y[g]=Math.min(b,Date.now()))}}catch(e){console.warn(e)}t.default=m},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(){_.default.isSupported()?(f.logger.info(R,"Use FetchStreamLoader"),D=_.default):v.default.isSupported()?(f.logger.info(R,"Use MozChunkedLoader"),D=v.default):b.default.isSupported()?(f.logger.info(R,"Use MSStreamLoader"),D=b.default):E.default.isSupported()?(f.logger.info(R,"Use RangeLoader"),D=E.default,L=102400):f.logger.error("Your browser doesn't support xhr with arraybuffer responseType!")}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,n)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(n)},f=r(0),c=r(19),d=n(c),h=r(6),p=n(h),y=r(22),_=n(y),m=r(23),v=n(m),g=r(24),b=n(g),S=r(25),E=n(S),k=r(8),T=n(k),w=r(30),O=n(w),P=r(32),C=n(P),M=r(1),A=n(M),R="TransmuxingController",L=4194304,D=void 0,x=function(e){function t(e){i(this,t);var r=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.dataSource,e.servers));r.player=e,r.startTime=e.bufferedPosition,r.qualityLevel=e._qualityLevels[e._currentQuality];for(var n in r.qualityLevel.list)r.qualityLevel.list[n].mediaInfo||(r.qualityLevel.list[n].mediaInfo={});return r.currentSegment=t.seekFlvSegment(r.qualityLevel.list,r.startTime),r.bufferedPosition=r.startTime,r.onInitSegment=null,r.onMediaSegment=null,r.onFlvHeader=null,r.onComplete=null,r.loadPos=0,r.startTime-r.qualityLevel.list[r.currentSegment].start>.1?r.isSeeking=!0:(r.isSeeking=!1,r.startTime=r.qualityLevel.list[r.currentSegment].start),r.newParser(),r.downloadSpeedMeter=new C.default,r.videoTrack={type:"video",id:1,sequenceNumber:0,samples:[]},r.audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[]},r.remuxer=new d.default(Math.round(1e3*r.startTime)),r.remuxer.onInitSegment=function(e){r.onInitSegment&&r.onInitSegment(e)},r.remuxer.onMediaSegment=function(e){r.onMediaSegment&&r.onMediaSegment(e)},D||s(),r.audioHeaderLoaded=!1,r.videoHeaderLoaded=!1,r._audioMeta=null,r._videoMeta=null,r._onMetaData=null,r._trackMetaDataSend=!1,r._initJob=!1,r}return o(t,e),u(t,[{key:"doWork",value:function(){var e=this;if(!this._initJob){this._initJob=!0;var t=this.qualityLevel.list[this.currentSegment].mediaInfo;t.flvHeader&&this._onGetFlvHeader(t.flvHeader),t.videoMeta&&(this._videoMeta=t.videoMeta,this.videoHeaderLoaded=!0),t.audioMeta&&(this._audioMeta=t.audioMeta,this.audioHeaderLoaded=!0),t.onMetaData&&(this._onMetaData=t.onMetaData),this._onGetMeta()}var r=this.player._isEverStart?60:2;if(!(this.player.currentTime+r<this.bufferedPosition)){if(this.loadPos===this.qualityLevel.list[this.currentSegment].size)return this.nextSegment(),void this.loop_async();if(this.httpServer){var n=this.qualityLevel.list[this.currentSegment],i=this.httpServer.getFullHttpUrl(this.getFormatPath(this.dataSource+"/../"+n.filename)),a=Math.floor(this.loadPos/L)*L+L,o=this.qualityLevel.size,s=this.player.duration,u=4e4;o>0&&s>0&&(u=s*(a-this.loadPos)*1e3/o,u=Math.min(4e4,Math.max(1e4,u)));var l=this.loader=new D(i,this.loadPos,a-1,u);this.loader.onDataArrival=function(t){e.loadPos+=t.byteLength,e.parser.parse(t)?(e.downloadSpeedMeter.add(t.byteLength),e.remuxer.remux(e.audioTrack,e.videoTrack)):(f.logger.error(R,"flv parse has error!"),f.logger.error(R,"loadPos\uff1a"+(e.loadPos-t.byteLength)+" dataSize:"+t.byteLength),e.setDone())},this.loader.onFileLengthKnown=function(t){e.setCurrentSegSize(t)},this.loader.onComplete=function(){l.redirected||e.httpServer.removeCurrentServerFromBlackList(),e.loader=null,e.loop_async()},this.loader.onError=function(){416===l.status?(e.nextSegment(),e.loop_async()):(e.nextServer(),l.isTimeout&&e.loop_async()),e.loader=null},this.loader.open()}else this.searchServer(this.dataSource+"/../"+this.qualityLevel.list[this.currentSegment].filename)}}},{key:"_onGetFlvHeader",value:function(e){e.hasAudio||(this.audioHeaderLoaded=!0),e.hasVideo||(this.videoHeaderLoaded=!0),this.qualityLevel.list[this.currentSegment].mediaInfo.flvHeader=e,null!==this.onFlvHeader&&this.onFlvHeader(e)}},{key:"newParser",value:function(){var e=this;this.parser=new O.default(this.loadPos),this.parser.onFlvHeader=function(t){e._onGetFlvHeader(t)},this.parser.onFlvTag=function(t){var r=t.timeStamp/1e3+e.qualityLevel.list[e.currentSegment].start;if(r>e.player.duration)return f.logger.warn(R,"Dropping frame whose timeStamp greater than duration,timeStamp:"+r),!0;e.bufferedPosition=Math.max(e.bufferedPosition,r);var n=Math.round(t.timeStamp+1e3*e.qualityLevel.list[e.currentSegment].start);switch(t.tagType){case T.default.TAG_TYPE_VIDEO:switch(t.avcPacketType){case T.default.AVC_PACKET_TYPE_SEQUENCE_HEADER:e.videoHeaderLoaded=!0;var i={};i.duration=0,i.type=e.videoTrack.type,i.id=e.videoTrack.id,i.timescale=1e3,i.avcc=t.aVCDecoderConfigurationRecord,i.codec=t.avcCodec;var a=t.sps;return i.codecWidth=a.codec_size.width,i.codecHeight=a.codec_size.height,i.presentWidth=a.present_size.width,i.presentHeight=a.present_size.height,i.refSampleDuration=Math.floor(i.timescale*a.frame_rate.fps_den/a.frame_rate.fps_num),e._videoMeta=i,e.qualityLevel.list[e.currentSegment].mediaInfo.videoMeta=i,e._onGetMeta();case T.default.AVC_PACKET_TYPE_NALU:var o={unit:t.avcData,isKeyframe:t.isKeyFrame,dts:n,cts:t.avcCompositionTimeOffset};e.videoTrack.samples.push(o),t.isKeyFrame&&e.remuxer.remux(e.audioTrack,e.videoTrack)}break;case T.default.TAG_TYPE_AUDIO:if(t.isAACSequenceHeader){e.audioHeaderLoaded=!0;var s={};if(s.duration=0,s.type=e.audioTrack.type,s.id=e.audioTrack.id,s.timescale=1e3,s.audioSampleRate=t.soundRate,s.channelCount=t.channelCount,s.codec="mp4a.40."+t.audioObjectType,s.refSampleDuration=Math.floor(t.frameLength*s.timescale/s.audioSampleRate),s.config=t.audioSpecificConfig,A.default.android&&A.default.chrome&&(/microMessenger/i.test(navigator.userAgent)||/mqqbrowser/i.test(navigator.userAgent))){var u=t.samplingIndex,l=t.channelConfig,c=new Array(2);c[0]=16,c[0]|=(15&u)>>>1,c[1]=(15&u)<<7,c[1]|=(15&l)<<3,s.config=c,s.codec="mp4a.40.2"}return e._audioMeta=s,e.qualityLevel.list[e.currentSegment].mediaInfo.audioMeta=s,e._onGetMeta()}var d={};d.dts=n,d.unit=t.aacData,e.audioTrack.samples.push(d);break;case T.default.TAG_TYPE_SCRIPTDATAOBJECT:var h=t.parseScriptData();return h.onMetaData&&(e._onMetaData=h.onMetaData,e.qualityLevel.list[e.currentSegment].mediaInfo.onMetaData=h.onMetaData),e._onGetMeta()}return!0}}},{key:"_onGetMeta",value:function(){var e=!0;if(!this._trackMetaDataSend&&this.audioHeaderLoaded&&this.videoHeaderLoaded){var r=[];this._audioMeta&&r.push(this._audioMeta),this._videoMeta&&r.push(this._videoMeta),r.length&&this.remuxer.appendTrackMetadata(r),this._trackMetaDataSend=!0}if(this.videoHeaderLoaded&&this.audioHeaderLoaded&&this._onMetaData&&this._onMetaData.keyframes){if(this.isSeeking){this.isSeeking=!1;var n=t.getNearestKeyframe(this._onMetaData.keyframes.times,this.startTime-this.qualityLevel.list[this.currentSegment].start);this.loadPos=this._onMetaData.keyframes.filepositions[n];var i=this._onMetaData.keyframes.times[n]+this.qualityLevel.list[this.currentSegment].start;this.startTime=Math.min(this.startTime,i),f.logger.info(R,"Start loading segment data from keyframe: "+i),this.newParser(),this.loader&&(this.loader.abort(),this.loader=null),e=!1,this.loop_async()}this.onMetaComplete&&this.onMetaComplete()}return e}},{key:"setCurrentSegSize",value:function(e){var t=this.qualityLevel.list[this.currentSegment].size,r=this.qualityLevel.list[this.currentSegment].filename;t&&t!=e&&f.logger.warn(R,r+" size is not consistent old :"+t+" new :"+e),this.qualityLevel.list[this.currentSegment].size=e}},{key:"nextSegment",value:function(){this.setCurrentSegSize(this.loadPos),this.currentSegment+=1,this.currentSegment>=this.qualityLevel.list.length&&this.setDone(),this.audioHeaderLoaded=!1,this.videoHeaderLoaded=!1,this._audioMeta=null,this._videoMeta=null,this._onMetaData=null,this._trackMetaDataSend=!1,this.loadPos=0,this.httpServer=null,this.newParser()}},{key:"stop",value:function(){l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"stop",this).call(this),this.onInitSegment=null,this.onMediaSegment=null,this.onComplete=null,this.onMetaComplete=null,this.onFlvHeader=null}},{key:"setDone",value:function(){this.remuxer.remux(this.audioTrack,this.videoTrack,!0),l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setDone",this).call(this),this.onComplete&&this.onComplete()}},{key:"downloadSpeed",get:function(){return this.downloadSpeedMeter.speed}}],[{key:"getNearestKeyframe",value:function(e,t){for(var r=0,n=e.length-2;r<n;){var i=Math.floor((r+n+1)/2);if(Math.round(1e3*e[i])==Math.round(1e3*t))return i;Math.round(1e3*e[i])>Math.round(1e3*t)?n=i-1:Math.round(1e3*e[i])<Math.round(1e3*t)&&(r=i)}return r}},{key:"seekFlvSegment",value:function(e,t){for(var r=0,n=e.length-1;r<n;){var i=Math.floor((r+n+1)/2);if(Math.round(1e3*e[i].start)===Math.round(1e3*t))return i;Math.round(1e3*e[i].start)>Math.round(1e3*t)?n=i-1:Math.round(1e3*e[i].start)<Math.round(1e3*t)&&(r=i)}return r}}]),t}(p.default);t.default=x},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(20),s=n(o),u=r(21),l=n(u),f=r(0),c=r(1),d=n(c),h="MP4Remuxer",p=function(){function e(t){i(this,e),s.default.init(),this._startTime=t,this._audioMeta=null,this._videoMeta=null,this._onInitSegment=null,this._onMediaSegment=null,this._lastAudioDts=null,this._lastVideoDts=null,this._firstVideoDts=null,this._forceFirstIDR=!(!d.default.chrome||!(d.default.version.major<50||50===d.default.version.major&&d.default.version.build<2661))}return a(e,[{key:"remux",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._remuxVideo(t,r),this._remuxAudio(e,r)}},{key:"appendTrackMetadata",value:function(e){var t=s.default.generateInitSegment(e),r=[];for(var n in e){var i=e[n];r.push(i.codec),"video"===i.type&&(this._videoMeta=i),"audio"===i.type&&(this._audioMeta=i)}var a="audio";this._videoMeta&&(a="video"),this._onInitSegment({data:t,codec:r.join(","),container:a+"/mp4"})}},{key:"_remuxAudio",value:function(e,t){var r=e,n=r.samples,i=-1;if(n&&n.length&&(t||!(n.length<=1))){var a=[],o=this._audioMeta.refSampleDuration;if(null==this._lastAudioDts&&(this._lastAudioDts=this._startTime-o,(d.default.msedge||d.default.msie)&&null!==this._firstVideoDts&&this._firstVideoDts<n[0].dts)){var u={dts:this._firstVideoDts,unit:l.default.getSilentFrame(this._audioMeta.channelCount)};f.logger.warn(h,"aac:"+(n[0].dts-this._firstVideoDts)+" ms hole between first frame and firstVideoDts detected,filling it"),f.logger.warn(h,"dts:"+n[0].dts+" firstVideoDts:"+this._firstVideoDts),a.push(u),this._lastAudioDts=this._startTime}for(var c=this._lastAudioDts,p=0;p<n.length;p++){var y=n[p];c+2*o<=y.dts&&(f.logger.warn(h,"aac:"+(y.dts-c-o)+" ms hole between frames detected,filling it"),f.logger.warn(h,"dts1:"+c+" dts2:"+y.dts));for(var _=c+o;_+o<=y.dts;_+=o){var m={dts:_,unit:l.default.getSilentFrame(this._audioMeta.channelCount)};a.push(m)}a.push(y),c=y.dts}for(var v=[],g=[],b=0;b+(t?0:1)<a.length;b++){var S=a[b],E=S.unit,k=S.dts;-1===i&&(i=k);var T=0;if(a.length>b+1){T=a[b+1].dts-k}else T=this._audioMeta.refSampleDuration;g.push(E);var w={dts:k,cts:0,size:E.byteLength,duration:T,flags:{isLeading:0,dependsOn:2,isDependedOn:2,hasRedundancy:0}};v.push(w)}var O=v[v.length-1];this._lastAudioDts=O.dts,r.samples=v,r.sequenceNumber++;var P=s.default.moof(r,i);r.samples=t?[]:[a[a.length-1]],this._onMediaSegment({type:"audio",data:this._generateMp4Seg(P,g)})}}},{key:"_remuxVideo",value:function(e,t){var r=e,n=r.samples,i=-1;if(null===this._firstVideoDts&&n.length&&(this._firstVideoDts=n[0].dts),n&&n.length&&(t||!(n.length<=1))){var a=[],o=this._videoMeta.refSampleDuration;if(null===this._lastVideoDts&&(this._lastVideoDts=this._startTime-o,d.default.safari&&this._startTime<n[0].dts)){var u={dts:this._startTime,cts:n[0].cts,unit:n[0].unit,isKeyframe:n[0].isKeyframe};f.logger.warn(h,"AVC:"+(n[0].dts-this._startTime)+" ms hole between first frame and startTime detected,filling it"),f.logger.warn(h,"dts:"+n[0].dts+" startTime:"+this._startTime),a.push(u),this._lastVideoDts=this._startTime}for(var l=this._lastVideoDts,c=0;c<n.length;c++){var p=n[c];l+2*o<=p.dts&&(f.logger.warn(h,"AVC:"+(p.dts-l-o)+" ms hole between frames detected,filling it"),f.logger.warn(h,"dts1:"+l+" dts2:"+p.dts));for(var y=l+o;y+o<=p.dts;y+=o){var _={dts:y,cts:p.cts,unit:p.unit,isKeyframe:p.isKeyframe};a.push(_)}a.push(p),l=p.dts}for(var m=[],v=[],g=0;g+(t?0:1)<a.length;g++){var b=a[g],S=b.unit,E=b.isKeyframe,k=b.dts,T=b.cts;-1===i&&(i=k),v.push(S);var w=0;if(a.length>g+1){w=a[g+1].dts-k}else w=this._videoMeta.refSampleDuration;var O={dts:k,cts:T,size:S.byteLength,isKeyframe:E,duration:w,flags:{isLeading:0,dependsOn:E?2:1,isDependedOn:E?1:0,hasRedundancy:0,isNonSync:E?0:1}};m.push(O)}var P=m[m.length-1];if(this._lastVideoDts=P.dts,this._forceFirstIDR){var C=m[0].flags;C.dependsOn=2,C.isNonSync=0}r.samples=m,r.sequenceNumber++;var M=s.default.moof(r,i);r.samples=t?[]:[a[a.length-1]],this._onMediaSegment({type:"video",data:this._generateMp4Seg(M,v)})}}},{key:"_generateMp4Seg",value:function(e,t){var r=8;for(var n in t)r+=t[n].byteLength;var i=new Uint8Array(e.byteLength+r);i.set(e,0),i[e.byteLength]=r>>>24&255,i[e.byteLength+1]=r>>>16&255,i[e.byteLength+2]=r>>>8&255,i[e.byteLength+3]=255&r,i.set(s.default.types.mdat,e.byteLength+4);var a=e.byteLength+8;for(var o in t){var u=t[o];i.set(u,a),a+=u.byteLength}return i}},{key:"onInitSegment",get:function(){return this._onInitSegment},set:function(e){this._onInitSegment=e}},{key:"onMediaSegment",get:function(){return this._onMediaSegment},set:function(e){this._onMediaSegment=e}}]),e}();t.default=p},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function(){function e(){n(this,e)}return i(e,null,[{key:"init",value:function(){e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};for(var t in e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var r=e.constants={};r.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),r.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),r.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),r.STSC=r.STCO=r.STTS,r.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),r.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),r.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),r.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}},{key:"box",value:function(e){for(var t=8,r=null,n=Array.prototype.slice.call(arguments,1),i=n.length,a=0;a<i;a++)t+=n[a].byteLength;r=new Uint8Array(t),r[0]=t>>>24&255,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r.set(e,4);for(var o=8,s=0;s<i;s++)r.set(n[s],o),o+=n[s].byteLength;return r}},{key:"generateInitSegment",value:function(t){var r=e.box(e.types.ftyp,e.constants.FTYP),n=e.moov(t),i=new Uint8Array(r.byteLength+n.byteLength);return i.set(r,0),i.set(n,r.byteLength),i}},{key:"moov",value:function(t){for(var r=e.mvhd(t[0].timescale,t[0].duration),n=t.length,i=[];n--;)i[n]=e.trak(t[n]);return e.box.apply(null,[e.types.moov,r].concat(i).concat(e.mvex(t)))}},{key:"mvhd",value:function(t,r){return e.box(e.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,r>>>24&255,r>>>16&255,r>>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))}},{key:"trak",value:function(t){return e.box(e.types.trak,e.tkhd(t),e.mdia(t))}},{key:"tkhd",value:function(t){var r=t.id,n=t.duration,i=t.presentWidth,a=t.presentHeight,o=0;return"audio"===t.type&&(o=1),e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r,0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n,0,0,0,0,0,0,0,0,0,0,0,0,o,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>>8&255,255&i,0,0,a>>>8&255,255&a,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t),e.hdlr(t),e.minf(t))}},{key:"mdhd",value:function(t){var r=t.timescale,n=t.duration;return e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r,n>>>24&255,n>>>16&255,n>>>8&255,255&n,85,196,0,0]))}},{key:"hdlr",value:function(t){var r=null;return r="audio"===t.type?e.constants.HDLR_AUDIO:e.constants.HDLR_VIDEO,e.box(e.types.hdlr,r)}},{key:"minf",value:function(t){var r=null;return r="audio"===t.type?e.box(e.types.smhd,e.constants.SMHD):e.box(e.types.vmhd,e.constants.VMHD),e.box(e.types.minf,r,e.dinf(),e.stbl(t))}},{key:"dinf",value:function(){return e.box(e.types.dinf,e.box(e.types.dref,e.constants.DREF))}},{key:"stbl",value:function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.constants.STTS),e.box(e.types.stsc,e.constants.STSC),e.box(e.types.stsz,e.constants.STSZ),e.box(e.types.stco,e.constants.STCO))}},{key:"stsd",value:function(t){return"audio"===t.type?e.box(e.types.stsd,e.constants.STSD_PREFIX,e.mp4a(t)):e.box(e.types.stsd,e.constants.STSD_PREFIX,e.avc1(t))}},{key:"mp4a",value:function(t){var r=t.channelCount,n=t.audioSampleRate,i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r,0,16,0,0,0,0,n>>>8&255,255&n,0,0]);return e.box(e.types.mp4a,i,e.esds(t))}},{key:"esds",value:function(t){var r=t.config,n=r.length,i=new Uint8Array([0,0,0,0,3,23+n,0,1,0,4,15+n,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([n]).concat(r).concat([6,1,2]));return e.box(e.types.esds,i)}},{key:"avc1",value:function(t){var r=t.avcc,n=t.codecWidth,i=t.codecHeight,a=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,n>>>8&255,255&n,i>>>8&255,255&i,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return e.box(e.types.avc1,a,e.box(e.types.avcC,r))}},{key:"mvex",value:function(t){for(var r=t.length,n=[];r--;)n[r]=e.trex(t[r]);return e.box.apply(null,[e.types.mvex].concat(n))}},{key:"trex",value:function(t){var r=t.id,n=new Uint8Array([0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return e.box(e.types.trex,n)}},{key:"moof",value:function(t,r){return e.box(e.types.moof,e.mfhd(t.sequenceNumber),e.traf(t,r))}},{key:"mfhd",value:function(t){var r=new Uint8Array([0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t]);return e.box(e.types.mfhd,r)}},{key:"traf",value:function(t,r){var n=t.id,i=e.box(e.types.tfhd,new Uint8Array([0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n])),a=e.box(e.types.tfdt,new Uint8Array([0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r])),o=e.trun(t,72);return e.box(e.types.traf,i,a,o)}},{key:"trun",value:function(t,r){var n=t.samples||[],i=n.length,a=12+16*i,o=new Uint8Array(a);r+=8+a,o.set([0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,255&i,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0);for(var s=0;s<i;s++){var u=n[s].duration,l=n[s].size,f=n[s].flags,c=n[s].cts;o.set([u>>>24&255,u>>>16&255,u>>>8&255,255&u,l>>>24&255,l>>>16&255,l>>>8&255,255&l,f.isLeading<<2|f.dependsOn,f.isDependedOn<<6|f.hasRedundancy<<4|f.isNonSync,0,0,c>>>24&255,c>>>16&255,c>>>8&255,255&c],12+16*s)}return e.box(e.types.trun,o)}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}}]),e}();t.default=a},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function(){function e(){n(this,e)}return i(e,null,[{key:"getSilentFrame",value:function(e){return 1===e?new Uint8Array([0,200,0,128,35,128]):2===e?new Uint8Array([33,0,73,144,2,25,0,35,128]):3===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]):4===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]):5===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]):6===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]):null}}]),e}();t.default=a},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=r(0),l=r(1),f=n(l),c=r(3),d=n(c),h=function(e){function t(){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),s(t,[{key:"open",value:function(){var e=this,t=new self.Headers;t.append("Range","bytes="+this.start+"-"+this.end);var r={method:"GET",headers:t};this.loadStartTime=Date.now(),self.fetch(this.requestUrl+"?"+this.params,r).then(function(t){return e.status=t.status,e.redirected=t.redirected,t.ok?(e._onGetRangeHeader(t.headers.get("Content-Range")),e._pump(t.body.getReader())):(e._reportError(),t.body.getReader().cancel())}).catch(function(t){u.logger.info(t),e._reportError()})}},{key:"_pump",value:function(e){var t=this;return!0===this.requestAbort?e.cancel():e.read().then(function(r){if(!r.done){var n=r.value;return t.receivedLength+=n.byteLength,t.onDataArrival&&t.onDataArrival(n),t._pump(e)}t.onComplete&&t.onComplete(),t.isDone=!0})}}],[{key:"isSupported",value:function(){try{return(!f.default.msedge||!(f.default.version.major<15||15===f.default.version.major&&f.default.version.build<15063))&&(self.fetch&&self.ReadableStream)}catch(e){return!1}}}]),t}(d.default);t.default=h},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,n)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(n)},u=r(0),l=r(3),f=function(e){return e&&e.__esModule?e:{default:e}}(l),c=function(e){function t(){return n(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),o(t,[{key:"open",value:function(){var e=this,t=this._xhr=new XMLHttpRequest;t.open("GET",this.requestUrl+"?"+this.params),t.timeout=this.timeout+this.ttfbTimeout,t.responseType="moz-chunked-arraybuffer",t.setRequestHeader("Range","bytes="+this.start+"-"+this.end),t.onreadystatechange=function(){t.readyState===XMLHttpRequest.HEADERS_RECEIVED&&(e.status=t.status,t.responseURL&&t.responseURL!==e.requestUrl&&(e.redirected=!0),t.status<200||t.status>299?e._reportError():e._onGetRangeHeader(t.getResponseHeader("Content-Range")))},t.onprogress=function(){if(t.status>=200&&t.status<=299&&t.response){var r=t.response;e.receivedLength+=r.byteLength,e.onDataArrival&&e.onDataArrival(new Uint8Array(r))}},t.onloadend=function(){if(t.status>=200&&t.status<=299)return e.onComplete&&e.onComplete(),void(e.isDone=!0);e._reportError()},t.ontimeout=function(){e.isTimeout=!0},this.loadStartTime=Date.now(),t.send()}},{key:"abort",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"abort",this).call(this),this._xhr&&(this._xhr.abort(),this._xhr=null)}}],[{key:"isSupported",value:function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="moz-chunked-arraybuffer","moz-chunked-arraybuffer"===e.responseType}catch(e){return u.logger.info(e),!1}}}]),t}(f.default);t.default=c},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,n)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(n)},u=r(0),l=r(3),f=function(e){return e&&e.__esModule?e:{default:e}}(l),c=function(e){function t(){return n(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),o(t,[{key:"open",value:function(){var e=this,t=this._reader=new self.MSStreamReader;t.onprogress=function(t){var r=e._reader.result,n=t.loaded-e.receivedLength;e.onDataArrival&&e.onDataArrival(new Uint8Array(r,e.receivedLength,n)),e.receivedLength+=n},t.onload=function(){e.onComplete&&e.onComplete(),e.isDone=!0},t.onerror=function(){e._reportError()};var r=this._xhr=new XMLHttpRequest;r.open("GET",this.requestUrl+"?"+this.params),r.timeout=this.timeout+this.ttfbTimeout,r.responseType="ms-stream",r.setRequestHeader("Range","bytes="+this.start+"-"+this.end),r.onreadystatechange=function(){if(r.readyState===XMLHttpRequest.HEADERS_RECEIVED)e.status=r.status,r.responseURL&&r.responseURL!==e.requestUrl&&(e.redirected=!0),r.status<200||r.status>299?e._reportError():e._onGetRangeHeader(r.getResponseHeader("Content-Range"));else if(r.readyState===XMLHttpRequest.LOADING&&r.status>=200&&r.status<=299){var t=r.response;e._reader.readAsArrayBuffer(t)}},r.onloadend=function(){r.status>=200&&r.status<=299||e._reportError()},r.ontimeout=function(){e.isTimeout=!0},this.loadStartTime=Date.now(),r.send()}},{key:"abort",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"abort",this).call(this),this._xhr&&(this._xhr.abort(),this._xhr=null)}}],[{key:"isSupported",value:function(){try{if(void 0===self.MSStream||void 0===self.MSStreamReader)return!1;var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="ms-stream","ms-stream"===e.responseType}catch(e){return u.logger.info(e),!1}}}]),t}(f.default);t.default=c},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,n)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(n)},u=r(0),l=r(3),f=function(e){return e&&e.__esModule?e:{default:e}}(l),c=function(e){function t(){return n(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),o(t,[{key:"open",value:function(){var e=this,t=this._xhr=new XMLHttpRequest;t.open("GET",this.requestUrl+"?"+this.params),t.timeout=this.timeout+this.ttfbTimeout,t.responseType="arraybuffer",t.setRequestHeader("Range","bytes="+this.start+"-"+this.end),t.onreadystatechange=function(){t.readyState===XMLHttpRequest.HEADERS_RECEIVED&&(e.status=t.status,t.responseURL&&t.responseURL!==e.requestUrl&&(e.redirected=!0),t.status<200||t.status>299?e._reportError():e._onGetRangeHeader(t.getResponseHeader("Content-Range")))},t.onprogress=function(t){e.receivedLength=t.loaded},t.onloadend=function(){if(t.status>=200&&t.status<=299&&t.response){var r=t.response;return e.onDataArrival&&e.onDataArrival(new Uint8Array(r)),e.onComplete&&e.onComplete(),void(e.isDone=!0)}e._reportError()},t.ontimeout=function(){e.isTimeout=!0},t.send()}},{key:"abort",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"abort",this).call(this),this._xhr&&(this._xhr.abort(),this._xhr=null)}}],[{key:"isSupported",value:function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="arraybuffer","arraybuffer"===e.responseType}catch(e){return u.logger.info(e),!1}}}]),t}(f.default);t.default=c},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(0),o=r(27),s=function(e){return e&&e.__esModule?e:{default:e}}(o),u=function(){function e(){n(this,e)}return i(e,null,[{key:"parseScriptData",value:function(t,r,n){var i={};try{var o=e.parseValue(t,r,n),s=e.parseValue(t,r+o.size,n-o.size);i[o.data]=s.data}catch(e){a.logger.error(e)}return i}},{key:"parseObject",value:function(t,r,n){if(n<3)throw new Error("Data not enough when parse ScriptDataObject");var i=e.parseString(t,r,n),a=e.parseValue(t,r+i.size,n-i.size),o=a.objectEnd;return{data:{name:i.data,value:a.data},size:i.size+a.size,objectEnd:o}}},{key:"parseString",value:function(e,t,r){if(r<2)throw new Error("Data not enough when parse String");var n=new DataView(e,t,r),i=n.getUint16(0),a=void 0;return a=i>0?(0,s.default)(new Uint8Array(e,t+2,i)):"",{data:a,size:2+i}}},{key:"parseLongString",value:function(e,t,r){if(r<4)throw new Error("Data not enough when parse LongString");var n=new DataView(e,t,r),i=n.getUint32(0),a=void 0;return a=i>0?(0,s.default)(new Uint8Array(e,t+4,i)):"",{data:a,size:4+i}}},{key:"parseDate",value:function(e,t,r){if(r<10)throw new Error("Data size invalid when parse Date");var n=new DataView(e,t,r),i=n.getFloat64(0);return i+=60*n.getInt16(8)*1e3,{data:new Date(i),size:10}}},{key:"parseValue",value:function(t,r,n){if(n<1)throw new Error("Data not enough when parse Value");var i=new DataView(t,r,n),o=1,s=i.getUint8(0),u=null,l=!1;switch(s){case 0:u=i.getFloat64(1),o+=8;break;case 1:u=!!i.getUint8(1),o+=1;break;case 2:var f=e.parseString(t,r+1,n-1);u=f.data,o+=f.size;break;case 3:for(u={};o<n;){var c=e.parseObject(t,r+o,n-o);if(o+=c.size,c.objectEnd)break;u[c.data.name]=c.data.value}break;case 8:u={};var d=i.getUint32(1);o+=4;for(var h=0;h<d;h++){var p=e.parseObject(t,r+o,n-o);u[p.data.name]=p.data.value,o+=p.size}break;case 9:u=void 0,o=1,l=!0;break;case 10:u=[];var y=i.getUint32(1);o+=4;for(var _=0;_<y;_++){var m=e.parseValue(t,r+o,n-o);u.push(m.data),o+=m.size}break;case 11:var v=e.parseDate(t,r+1,n-1);u=v.data,o+=v.size;break;case 12:var g=e.parseString(t,r+1,n-1);u=g.data,o+=g.size;break;default:o=n,a.logger.warn("AMF","Unsupported AMF value type "+s)}return{data:u,size:o,objectEnd:l}}}]),e}();t.default=u},function(e,t,r){"use strict";function n(e,t,r){var n=e;if(t+r<n.length){for(;r--;)if(128!=(192&n[++t]))return!1;return!0}return!1}function i(e){for(var t=[],r=e,i=0,a=e.length;i<a;)if(r[i]<128)t.push(String.fromCharCode(r[i])),++i;else{if(r[i]<192);else if(r[i]<224){if(n(r,i,1)){var o=(31&r[i])<<6|63&r[i+1];if(o>=128){t.push(String.fromCharCode(65535&o)),i+=2;continue}}}else if(r[i]<240){if(n(r,i,2)){var s=(15&r[i])<<12|(63&r[i+1])<<6|63&r[i+2];if(s>=2048&&55296!=(63488&s)){t.push(String.fromCharCode(65535&s)),i+=3;continue}}}else if(r[i]<248&&n(r,i,3)){var u=(7&r[i])<<18|(63&r[i+1])<<12|(63&r[i+2])<<6|63&r[i+3];if(u>65536&&u<1114112){u-=65536,t.push(String.fromCharCode(u>>>10|55296)),t.push(String.fromCharCode(1023&u|56320)),i+=4;continue}}t.push(String.fromCharCode(65533)),++i}return t.join("")}Object.defineProperty(t,"__esModule",{value:!0}),t.default=i},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(29),o=function(e){return e&&e.__esModule?e:{default:e}}(a),s=function(){function e(){n(this,e)}return i(e,null,[{key:"_ebsp2rbsp",value:function(e){for(var t=e,r=t.byteLength,n=new Uint8Array(r),i=0,a=0;a<r;a++)a>=2&&3===t[a]&&0===t[a-1]&&0===t[a-2]||(n[i]=t[a],i++);return new Uint8Array(n.buffer,0,i)}},{key:"parseSPS",value:function(t){var r=e._ebsp2rbsp(t),n=new o.default(r);n.readByte();var i=n.readByte();n.readByte();var a=n.readByte();n.readUEG();var s=e.getProfileString(i),u=e.getLevelString(a),l=1,f=420,c=[0,420,422,444],d=8;if((100===i||110===i||122===i||244===i||44===i||83===i||86===i||118===i||128===i||138===i||144===i)&&(l=n.readUEG(),3===l&&n.readBits(1),l<=3&&(f=c[l]),d=n.readUEG()+8,n.readUEG(),n.readBits(1),n.readBool()))for(var h=3!==l?8:12,p=0;p<h;p++)n.readBool()&&(p<6?e._skipScalingList(n,16):e._skipScalingList(n,64));n.readUEG();var y=n.readUEG();if(0===y)n.readUEG();else if(1===y){n.readBits(1),n.readSEG(),n.readSEG();for(var _=n.readUEG(),m=0;m<_;m++)n.readSEG()}n.readUEG(),n.readBits(1);var v=n.readUEG(),g=n.readUEG(),b=n.readBits(1);0===b&&n.readBits(1),n.readBits(1);var S=0,E=0,k=0,T=0;n.readBool()&&(S=n.readUEG(),E=n.readUEG(),k=n.readUEG(),T=n.readUEG());var w=1,O=1,P=0,C=!0,M=0,A=0;if(n.readBool()){if(n.readBool()){var R=n.readByte(),L=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],D=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];R>0&&R<16?(w=L[R-1],O=D[R-1]):255===R&&(w=n.readByte()<<8|n.readByte(),O=n.readByte()<<8|n.readByte())}if(n.readBool()&&n.readBool(),n.readBool()&&(n.readBits(4),n.readBool()&&n.readBits(24)),n.readBool()&&(n.readUEG(),n.readUEG()),n.readBool()){var x=n.readBits(32),j=n.readBits(32);C=n.readBool(),M=j,A=2*x,P=M/A}}var U=1;1===w&&1===O||(U=w/O);var H=0,B=0;if(0===l)H=1,B=2-b;else{var F=3===l?1:2,N=1===l?2:1;H=F,B=N*(2-b)}var G=16*(v+1),q=16*(g+1)*(2-b);G-=(S+E)*H,q-=(k+T)*B;var I=Math.ceil(G*U);return{profile_string:s,level_string:u,bit_depth:d,chroma_format:f,chroma_format_string:e.getChromaFormatString(f),frame_rate:{fixed:C,fps:P,fps_den:A,fps_num:M},sar_ratio:{width:w,height:O},codec_size:{width:G,height:q},present_size:{width:I,height:q}}}},{key:"_skipScalingList",value:function(e,t){for(var r=8,n=8,i=0,a=0;a<t;a++)0!==n&&(i=e.readSEG(),n=(r+i+256)%256),r=0===n?r:n}},{key:"getProfileString",value:function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}},{key:"getLevelString",value:function(e){return(e/10).toFixed(1)}},{key:"getChromaFormatString",value:function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}}]),e}();t.default=s},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function(){function e(t){n(this,e),this._buffer=t,this._pos=0}return i(e,[{key:"readBit",value:function(){var e=1<<7-(7&this._pos),t=this._pos>>3;return this._pos++,0==(this._buffer[t]&e)?0:1}},{key:"readBits",value:function(e){for(var t=0,r=0;r<e;r++)t=2*t+this.readBit();return t}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readByte",value:function(){return this.readBits(8)}},{key:"readUEG",value:function(){for(var e=0;0===this.readBit();)e++;for(var t=1,r=0;r<e;r++)t=2*t+this.readBit();return--t}},{key:"readSEG",value:function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)}}]),e}();t.default=a},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0),s=r(31),u=n(s),l=r(8),f=n(l),c=r(5),d=n(c),h=Object.freeze({File_Header:(0,d.default)("File_Header"),File_Header_REST:(0,d.default)("File_Header_REST"),Header:(0,d.default)("Header"),Data:(0,d.default)("Data")}),p=function(){function e(t){i(this,e),t?(this.offset=t,this.state=h.Header):(this.offset=0,this.state=h.File_Header),this.cacheDatas=[],this.cacheSize=0}return a(e,[{key:"appendData",value:function(e){this.cacheDatas.push(e),this.cacheSize+=e.byteLength}},{key:"preRead",value:function(e){for(var t=e,r=new Uint8Array(e),n=0;t;){var i=this.cacheDatas[n];i.byteLength<t?(r.set(i,e-t),t-=i.byteLength,n++):(r.set(i.subarray(0,t),e-t),t=0)}return r}},{key:"read",value:function(e){var t=void 0;if(e==this.cacheDatas[0].byteLength)t=this.cacheDatas.shift();else{var r=e;t=new Uint8Array(e);for(var n=0;r;){var i=this.cacheDatas[n];i.byteLength<=r?(t.set(i,e-r),r-=i.byteLength,n++):(t.set(i.subarray(0,r),e-r),this.cacheDatas[n]=i.subarray(r),r=0)}this.cacheDatas.splice(0,n)}return this.cacheSize-=e,t}},{key:"parse",value:function(e){e&&this.appendData(e);for(var t=!0,r=void 0;t;)switch(this.state){case h.File_Header:if(this.cacheSize>=u.default.MIN_FILE_HEADER_BYTE_COUNT){if(this.flvHeader=new u.default,this.flvHeader.buffer=this.preRead(u.default.MIN_FILE_HEADER_BYTE_COUNT),this.flvHeader.hasError)return o.logger.error("FlvParser","flv Header has error!"),!1;this.state=h.File_Header_REST}else t=!1;break;case h.File_Header_REST:r=this.flvHeader.dataOffset+f.default.PREV_TAG_BYTE_COUNT,this.cacheSize>=r?(this.flvHeader.buffer=this.read(r),this.onFlvHeader&&this.onFlvHeader(this.flvHeader),this.state=h.Header):t=!1;break;case h.Header:this.cacheSize>=f.default.TAG_HEADER_BYTE_COUNT?(this.currentTag=new f.default,this.currentTag.buffer=this.preRead(f.default.TAG_HEADER_BYTE_COUNT),this.state=h.Data):t=!1;break;case h.Data:if(r=f.default.TAG_HEADER_BYTE_COUNT+this.currentTag.dataSize+f.default.PREV_TAG_BYTE_COUNT,this.cacheSize>=r){if(this.currentTag.buffer=this.read(r),this.currentTag.hasError)return o.logger.error("FlvParser","flv tag has error!"),!1;this.onFlvTag&&(t=this.onFlvTag(this.currentTag)),this.state=h.Header}else t=!1}return!0}}]),e}();t.default=p},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function(){function e(){n(this,e)}return i(e,[{key:"hasError",get:function(){return this.dataOffset>1024||70!=this.buffer[0]||76!=this.buffer[1]||86!=this.buffer[2]||!this.hasVideo&&!this.hasAudio}},{key:"hasVideo",get:function(){return 0!=(1&this.buffer[4])}},{key:"hasAudio",get:function(){return 0!=(4&this.buffer[4])}},{key:"dataOffset",get:function(){var e=0;return e+=this.buffer[5]<<24,e+=this.buffer[6]<<16,e+=this.buffer[7]<<8,e+=this.buffer[8]}}],[{key:"MIN_FILE_HEADER_BYTE_COUNT",get:function(){return 9}}]),e}();t.default=a},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function(){function e(){n(this,e),this.totalBytes=0,this.items=[],this.currentTime=Date.now()}return i(e,[{key:"clean",value:function(){for(var e=Date.now();this.items.length>0&&(this.items[0].currentTime+3e3<e||this.items[0].currentTime>e+100);)this.items.shift()}},{key:"add",value:function(e){this.totalBytes+=e,this.currentTime=Date.now(),(0===this.items.length||this.items[this.items.length-1].currentTime+1e3<this.currentTime)&&this.items.push({totalBytes:this.totalBytes,currentTime:this.currentTime}),this.clean()}},{key:"speed",get:function(){if(this.clean(),this.items.length){var e=this.items[0];return e.currentTime>=this.currentTime?0:1e3*(this.totalBytes-e.totalBytes)/(this.currentTime-e.currentTime)}return 0}}]),e}();t.default=a},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,n)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(n)},u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=r(2),f=n(l),c=r(9),d=n(c),h=r(0),p=r(1),y=n(p),_=function(e){function t(){i(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return y.default.ios&&(e._mediaEvent.loadeddata=e._mediaEvent.loadedmetadata,delete e._mediaEvent.loadedmetadata),e._customeMediaEvent={play:function(){e._doAttachMedia()}},e}return o(t,e),u(t,null,[{key:"isSupported",get:function(){try{return document.createElement("video").canPlayType('video/mp4; codecs="avc1.640029,mp4a.40.5"')}catch(e){h.logger.error(e)}return!1}},{key:"isSupportHls",get:function(){try{return document.createElement("video").canPlayType("application/vnd.apple.mpegURL")}catch(e){h.logger.error(e)}return!1}}]),u(t,[{key:"setCurrentQuality",value:function(e,t){h.logger.warn("WhatyMediaPlayerNative","Change quality is not supported with native player")}},{key:"_parseMeta",value:function(e){return!!s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_parseMeta",this).call(this,e)&&(this._mp4FileName=this._getSrcFileName(e),null!==this._mp4FileName)}},{key:"_getSrcFileName",value:function(e){if(e.m3u8&&t.isSupportHls)return e.m3u8;if(e.mp4)return e.mp4;if(e.orimp4)return e.orimp4;for(var r=0;r<this._qualityLevels.length;r++){var n=this._qualityLevels[r];if("360P"===n.label&&n.mp4)return n.mp4}return this._qualityLevels[0].mp4?this._qualityLevels[0].mp4:null}},{key:"_addMediaEvents",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_addMediaEvents",this).call(this);for(var e in this._customeMediaEvent)this._mediaElement.addEventListener(e,this._customeMediaEvent[e])}},{key:"_init",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_init",this).call(this),this._mp4FileName=null,this._mp4ServerLoader=null}},{key:"reset",value:function(){if(this._mp4ServerLoader&&(this._mp4ServerLoader.stop(),this._mp4ServerLoader=null),this._mediaElement){for(var e in this._customeMediaEvent)this._mediaElement.removeEventListener(e,this._customeMediaEvent[e]);this._mediaElement.removeAttribute("src"),this._mediaElement.load()}s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"reset",this).call(this)}},{key:"_reAttachMedia",value:function(){if(this._mediaElement){var e=this._mediaElement.paused,t=this.currentTime;this._canseek=!1,this._mediaElement.load(),this.currentTime=t,e?this._isEverStart&&this._mediaElement.pause():this._mediaElement.play()}}},{key:"_onGetMp4Url",value:function(e){this._isLoadingStart=!0,this._notifyStateChanged(),this._mediaElement&&(this._mediaElement.src=e,this._reAttachMedia())}},{key:"_doAttachMedia",value:function(){this._mp4ServerLoader||(this._mp4ServerLoader=new d.default(this))}},{key:"qualityLevels",get:function(){return[]}},{key:"currentQuality",get:function(){return 0},set:function(e){this.setCurrentQuality(e,!1)}}]),t}(f.default);t.default=_},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function e(t,r,n,i){var a=Object.getOwnPropertyDescriptor(t,r);if(void 0===a){var o=Object.getPrototypeOf(t);null!==o&&e(o,r,n,i)}else if("value"in a&&a.writable)a.value=n;else{var s=a.set;void 0!==s&&s.call(i,n)}return n},u=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,n)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(n)},l=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),f=r(2),c=n(f),d=r(9),h=n(d),p=r(4),y=n(p),_=r(35),m=n(_),v=r(36),g=n(v),b=r(0),S="WhatyMediaPlayerAli",E=function(e){function t(){i(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._controls=!0,e._aliMediaEvent={playing:function(t){e._isPlaying=!0,e._notifyStateChanged(t)},waiting:function(t){e._isPlaying=!1,e._checkPlayingRef=null,e._notifyStateChanged(t)},pause:function(t){e.onStateChanged&&e.onStateChanged(t)},play:function(t){e._isEverStart=!0,e._notifyStateChanged(t)},ended:function(t){e._notifyStateChanged(t)},ready:function(t){e._isReady=!0,e._isLoadingStart=!0,e._initSpeedSetting(),e._onCanSeek(),e._notifyStateChanged(t),e._onTimeUpdate()},timeupdate:function(t){e._notifyStateChanged(t),e.onStateChanged&&e.onStateChanged(t)},requestFullScreen:function(t){e.onStateChanged&&e.onStateChanged(t)},cancelFullScreen:function(t){e.onStateChanged&&e.onStateChanged(t)},startSeek:function(t){e.onStateChanged&&e.onStateChanged(t)},completeSeek:function(t){e.onStateChanged&&e.onStateChanged(t)},canplay:function(t){e.onStateChanged&&e.onStateChanged(t)},error:function(t){e.aliPlayer.getComponent("AliPlayerComponentCtrl").showError(t.paramData),b.logger.error(S,"media error:"+t.paramData.display_msg),e._handleError()}},e}return o(t,e),l(t,null,[{key:"isSupportedHtml5",get:function(){if(window.MediaSource&&"function"==typeof window.MediaSource.isTypeSupported&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.640029,mp4a.40.5"'))return!0;try{return document.createElement("video").canPlayType('video/mp4; codecs="avc1.640029,mp4a.40.5"')}catch(e){b.logger.error(e)}return!1}}]),l(t,[{key:"prepare",value:function(){if(this.dataSource&&this.dataSource.indexOf("meta.json")>0)u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"prepare",this).call(this);else{if(!this.dataSource||!this._mediaElement)return void b.logger.error("please set dataSource and mediaElement before run prepare!");this.isReady&&this.aliPlayer.loadByUrl(this.dataSource)}}},{key:"play",value:function(){if(this.isReady)try{this.aliPlayer.play()}catch(e){b.logger.error(e)}}},{key:"reset",value:function(){this._mp4ServerLoader&&(this._mp4ServerLoader.stop(),this._mp4ServerLoader=null),this._init()}},{key:"pause",value:function(){if(this.isReady)try{this.aliPlayer.pause()}catch(e){b.logger.error(e)}}},{key:"load",value:function(){this.isReady&&this.aliPlayer.replay()}},{key:"initAliPlayer",value:function(){if((this.dataSource&&this.dataSource.indexOf("meta.json")<0||this._videoFileUrl)&&this.mediaElementId){var e=this;if("function"==typeof Aliplayer){this._isReady=!1,this.aliPlayer&&this.aliPlayer.dispose(),this._mediaElement&&"video"===this._mediaElement.tagName.toLocaleLowerCase()&&(this._mediaElement.controls=!1);var t=this._getVideoFileUrl(),r={id:this.mediaElementId,autoplay:!0,isLive:!1,playsinline:!0,controlBarVisibility:"hover",source:t,x5_video_position:"normal",x5_type:"h5",components:[{name:"AliPlayerComponentCtrl",type:g.default}]};if(!1===this._controls&&(r.skinLayout=!1),t){var n=t.lastIndexOf(".");if(n>0){var i=t.substring(n,t.length);i&&".flv"===i&&(r.useFlashPrism=!0)}}if(this.aliPlayer=new Aliplayer(r),this._aliMediaEvent)for(var a in this._aliMediaEvent)this.aliPlayer.on(a,this._aliMediaEvent[a])}else setTimeout(function(){e.initAliPlayer()},20)}}},{key:"setCurrentQuality",value:function(e,t){var r=this._getVideoFileUrl(),n=JSON.parse(r),i=n[e];if(i&&""!=i)return void this.aliPlayer.loadByUrl(i,this.aliPlayer.getCurrentTime());console.error("\u64ad\u653e\u5730\u5740\u4e0d\u5b58\u5728")}},{key:"_parseMeta",value:function(e){return!!u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_parseMeta",this).call(this,e)&&(this._mp4FileName=this._getSrcFileName(e),null!==this._mp4FileName)}},{key:"_getSrcFileName",value:function(e){if(e.m3u8)return e.m3u8;if(e.mp4)return e.mp4;if(e.orimp4)return e.orimp4;for(var t=0;t<this._qualityLevels.length;t++){var r=this._qualityLevels[t];if("360P"===r.label&&r.mp4)return r.mp4}return this._qualityLevels[0].mp4?this._qualityLevels[0].mp4:null}},{key:"_addMediaEvents",value:function(){if(u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_addMediaEvents",this).call(this),this._mediaElement.addEventListener)for(var e in this._customeMediaEvent)this._mediaElement.addEventListener(e,this._customeMediaEvent[e])}},{key:"_init",value:function(){u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_init",this).call(this),this.aliPlayer||(this.aliPlayer=null),this._isReady=!1,this._playbackRates=!1,this._mp4FileName=null,this._videoFileUrl=null,this._mp4ServerLoader=null,this.mediaElementId=null,this._currentVolume=null}},{key:"_initSpeedSetting",value:function(){if(this.aliPlayer.getComponent){var e=this.aliPlayer.getComponent("AliPlayerComponentCtrl");this._playbackRates?e.showSpeed():e.hiddenSpeed()}}},{key:"_onCanSeek",value:function(){this._canseek=!0,null!==this._pendingSeek&&(b.logger.info(S,"Do pendingSeek to "+this._pendingSeek),this.aliPlayer.seek(this._pendingSeek),this._pendingSeek=null)}},{key:"_onTimeUpdate",value:function(){if(this.isReady&&void 0===this.aliPlayer.fullscreenService){this.state!==y.default.Paused&&this.state!==y.default.PreparingError&&this.state!==y.default.Buffering&&this.state!==y.default.PlayBackCompleted&&this.onStateChanged&&this.onStateChanged();var e=this;setTimeout(function(){e._onTimeUpdate()},1e3)}}},{key:"_reAttachMedia",value:function(){if(this.aliPlayer){var e=this.currentTime;this._canseek=!1,this.currentTime=e}}},{key:"_onGetMp4Url",value:function(e){this._videoFileUrl=e,this.initAliPlayer(),this._reAttachMedia()}},{key:"_getVideoFileUrl",value:function(){return this._videoFileUrl?this._videoFileUrl:this.dataSource}},{key:"_doAttachMedia",value:function(){this._mp4ServerLoader||(this._mp4ServerLoader=new h.default(this))}},{key:"state",get:function(){if(this.isReady&&this._state!==y.default.PreparingError){var e=this.aliPlayer.getStatus();switch(e){case m.default.Loading:e=y.default.Preparing;break;case m.default.Play:e=y.default.Playing;break;case m.default.Error:e=y.default.PreparingError;break;case m.default.Playing:e=y.default.Playing;break;case m.default.Pause:e=y.default.Paused;break;case m.default.Ended:e=y.default.PlayBackCompleted;break;case m.default.Waiting:e=y.default.Buffering;break;default:e=y.default.Idle}return e}return this._state}},{key:"dataSource",get:function(){return u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"dataSource",this)},set:function(e){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"dataSource",e,this),this.initAliPlayer()}},{key:"qualityLevels",get:function(){return[]}},{key:"currentQuality",get:function(){return 0},set:function(e){this.setCurrentQuality(e,!1)}},{key:"mediaElement",set:function(e){var r=null;"string"==typeof e?(this.mediaElementId=e,r=document.getElementById(e)):(e.id?this.mediaElementId=e.id:(e.id="video_"+Math.random(),this.mediaElementId=e.id),r=e),s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"mediaElement",r,this),this.initAliPlayer()}},{key:"currentTime",get:function(){return this._pendingSeek?this._pendingSeek:this.isReady?this.aliPlayer.getCurrentTime():0},set:function(e){if(!this._canseek)return b.logger.info(S,"Can not set currentTime now, try to do pendingSeek after loadedmetadata!"),this._pendingSeek=e,void this._onSeeking();this.isReady&&this.aliPlayer.seek(e)}},{key:"buffered",get:function(){if(this.isReady&&this.videoTag)return this.videoTag.buffered}},{key:"duration",get:function(){return this._meta?this._meta.duration:this.isReady?this.aliPlayer.getDuration():NaN}},{key:"volume",get:function(){return this.isReady?this.aliPlayer.getVolume():1},set:function(e){this.isReady&&(this.aliPlayer.setVolume(e),this._currentVolume=this.aliPlayer.getVolume())}},{key:"muted",get:function(){return!(!this.isReady||0!==this.aliPlayer.getVolume())},set:function(e){this.isReady&&(!0===e?(this._currentVolume=this.aliPlayer.getVolume(),this.aliPlayer.setVolume(0)):this._currentVolume?this.aliPlayer.setVolume(this._currentVolume):this.aliPlayer.setVolume(1))}},{key:"bufferedPosition",get:function(){return this._pendingSeek?this._pendingSeek:this.isReady?this.currentTime:0}},{key:"playbackRates",set:function(e){e&&(e.length>0||!0===e)?this._playbackRates=!0:this._playbackRates=!1,this.isReady&&this._initSpeedSetting()}},{key:"playbackRate",get:function(){return this.isReady&&this.videoTag?this.videoTag.playbackRate:1},set:function(e){this.isReady&&this.aliPlayer.setSpeed(e)}},{key:"videoWidth",get:function(){return this._mediaElement?this._mediaElement.offsetWidth:-1}},{key:"videoHeight",get:function(){return this._mediaElement?this._mediaElement.offsetHeight:-1}},{key:"controls",set:function(e){this._controls=!1!==e}},{key:"fullScreen",set:function(e){this.isReady&&(e=!!e,this.aliPlayer.fullscreenService&&(e?this.aliPlayer.fullscreenService.requestFullScreen():this.aliPlayer.fullscreenService.cancelFullScreen()))},get:function(){return!(!this.isReady||!this.aliPlayer.fullscreenService)&&this.aliPlayer.fullscreenService.getIsFullScreen()}},{key:"isReady",get:function(){return this.aliPlayer&&!0===this._isReady}},{key:"videoTag",get:function(){return this._mediaElement?"video"===this._mediaElement.tagName.toLocaleLowerCase()?this._mediaElement:this._mediaElement.querySelector("video"):null}}]),t}(c.default);t.default=E},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.freeze({Init:"init",Ready:"ready",Loading:"loading",Play:"play",Pause:"pause",Playing:"playing",Waiting:"waiting",Error:"error",Ended:"ended"});t.default=n},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function(){function e(){n(this,e)}return i(e,[{key:"createEl",value:function(){}},{key:"created",value:function(){}},{key:"hiddenSpeed",value:function(){var e=document.querySelector(".prism-setting-item.prism-setting-speed");e&&(e.style.display="none")}},{key:"showSpeed",value:function(){var e=document.querySelector(".prism-setting-item.prism-setting-speed");e&&(e.style.display="block")}},{key:"showError",value:function(e){if(e&&4006===e.error_code){var t=document.querySelector(".prism-ErrorMessage .prism-error-content p");t&&(t.style.fontSize="16px",t.textContent="\u89c6\u9891\u6b63\u5728\u52aa\u529b\u8f6c\u7801\u4e2d...",document.querySelector(".prism-ErrorMessage .prism-error-content").style.marginTop="80px",document.querySelector(".prism-ErrorMessage .prism-detect-info").style.display="none",document.querySelector(".prism-ErrorMessage .prism-error-operation").style.borderBottom="0px",document.querySelector(".prism-ErrorMessage .prism-error-operation .prism-button-orange").style.display="none")}}},{key:"ready",value:function(){var e=document.querySelectorAll(".prism-setting-item.prism-setting-audio,.prism-setting-item.prism-setting-cc,.prism-cc-btn");if(e)for(var t=0;t<e.length;t++)e[t].style.display="none";var r=document.createElement("style");r.appendChild(document.createTextNode(".prism-player .prism-setting-selector span, .prism-player .prism-controlbar span, .prism-player .prism-setting-item span{color:#ebecec}")),r.type="text/css",document.getElementsByTagName("head")[0].appendChild(r)}}]),e}();t.default=a},function(e,t,r){"use strict";function n(e){var t=i.NEW;this.load=function(){if(t==i.NEW){var r=n.loaders[e];if(r&&(t=r.getStatus())<2)return;var o=a.createElement("script");o.addEventListener?(o.onload=this.sendComplete,o.onerror=this.sendError):o.readyState&&(o.onreadystatechange=function(e){"loaded"!=o.readyState&&"complete"!=o.readyState||this.sendComplete(e)}),a.getElementsByTagName("head")[0].appendChild(o),o.src=e,t=i.LOADING,n.loaders[e]=this}},this.sendError=function(e){t=i.ERROR,window.console.info(e)},this.sendComplete=function(){t=i.COMPLETE},this.getStatus=function(){return t},this.addEventListener=function(e,t){return"ERROR"===e?this.sendError=t:"COMPLETE"===e&&(this.sendComplete=t),!1}}Object.defineProperty(t,"__esModule",{value:!0});var i={NEW:0,LOADING:1,ERROR:2,COMPLETE:3},a=document;n.loaders={},t.default=n},function(e,t,r){"use strict";function n(e){var t=document.createElement("link");document.getElementsByTagName("head")[0].appendChild(t),t.href=e,t.rel="stylesheet"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n}]);