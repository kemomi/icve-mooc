"use strict";

function _typeof(a) {
    return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (a) {
        return typeof a
    } : function (a) {
        return a && "function" == typeof Symbol && a.constructor === Symbol && a !== Symbol.prototype ? "symbol" : typeof a
    }, _typeof(a)
}

var LBPWatermark = function () {
    function a(a, b) {
        var d, e, f, g, h, c = this;
        if (void 0 === b && (b = {}), this.defaultSettings = {
            disableLowBrowser: !1,
            x: 10,
            y: 70,
            rows: 2e3,
            cols: 2e3,
            xSpace: 50,
            ySpace: 120,
            color: "#999",
            opacity: .1,
            fontSize: "14px",
            font: "Microsoft Yahei",
            width: 210,
            height: 30,
            angle: 35
        }, "object" === _typeof(b)) for (d in b) b[d] && this.defaultSettings[d] && b[d] === this.defaultSettings[d] || b[d] && (this.defaultSettings[d] = b[d]);
        this.inputText = a, this.guid = "_coaWaterMark", this.total = 0, this.observer = null, this.resizeTimer = null, this.monitorTimer = null, window.addEventListener("resize", function () {
            c.resizeTimer || (c.resizeTimer = setTimeout(function () {
                c.resizeTimer = null, c.rebuild()
            }, 400))
        })
    }

    var b = a.prototype;
    return b.init = function () {
        var b, c, d, e, f, g, h, i, j, k, l, m, a = this;
        if (this.isIE10()) return this.defaultSettings.disableLowBrowser, console.warn("您的浏览器版本过低，请及时升级！"), !1;
        for (b = document.createDocumentFragment(), c = this.defaultSettings.videoId ? document.getElementById(this.defaultSettings.videoId) : document.body, d = Math.max(c.scrollWidth, c.clientWidth), e = Math.max(c.scrollHeight, c.clientHeight), this.defaultSettings.cols = Math.ceil(d / (this.defaultSettings.xSpace + this.defaultSettings.width)), this.defaultSettings.rows = Math.ceil(e / (this.defaultSettings.ySpace + this.defaultSettings.height)), h = 0; h < this.defaultSettings.rows; h++) for (g = this.defaultSettings.y + (this.defaultSettings.ySpace + this.defaultSettings.height) * h, i = 0; i < this.defaultSettings.cols; i++) f = this.defaultSettings.x + (this.defaultSettings.width + this.defaultSettings.xSpace) * i, j = document.createElement("div"), j.id = this.guid + h + i, j.className = this.guid, j.innerHTML = this.inputText, j.style.webkitTransform = "rotate(-" + this.defaultSettings.angle + "deg)", j.style.MozTransform = "rotate(-" + this.defaultSettings.angle + "deg)", j.style.msTransform = "rotate(-" + this.defaultSettings.angle + "deg)", j.style.OTransform = "rotate(-" + this.defaultSettings.angle + "deg)", j.style.transform = "rotate(-" + this.defaultSettings.angle + "deg)", j.style.visibility = "visible", j.style.position = "absolute", j.style.left = f + "px", j.style.top = g + "px", j.style.overflow = "hidden", j.style.zIndex = "999999", j.style.pointerEvents = "none", j.style.filter = "alpha(opacity=50)", j.style.opacity = this.defaultSettings.opacity + .1 * Math.random(), j.style.fontSize = this.defaultSettings.fontSize, j.style.fontFamily = this.defaultSettings.font, j.style.color = this.defaultSettings.color, j.style.textAlign = "center", j.style.width = this.defaultSettings.width + "px", j.style.height = this.defaultSettings.height + "px", j.style.whiteSpace = "nowrap", j.style.display = "block", b.appendChild(j), this.total += 1;
        c.appendChild(b), this.monitorTimer || (this.monitorTimer = setTimeout(function () {
            a.monitorTimer = null, a.monitor()
        }, 2e3))
    }, b.isIE10 = function () {
        var a, b;
        return "Microsoft Internet Explorer" == navigator.appName && (a = navigator.userAgent, null != a.match(/MSIE ([0-9]{1,}[\.0-9]{0,})/) && (b = parseFloat(RegExp.$1), 11 > b)) ? !0 : !1
    }, b.monitor = function () {
        var c, a = this, b = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver;
        b ? (this.observer = new b(function (b) {
            var e, d = b[0];
            return d.removedNodes[0] && (e = d.removedNodes[0], e.className == a.guid || e.id && 0 === e.id.indexOf(a.guid)) ? (a.rebuild(), !1) : "style" === d.attributeName && d.target.className == a.guid ? (a.rebuild(), !1) : "characterData" == d.type && d.target.parentElement.className == a.guid ? (a.rebuild(), !1) : "class" != d.attributeName && "id" != d.attributeName || !d.oldValue || 0 !== d.oldValue.indexOf(a.guid) ? document.getElementsByClassName(a.guid).length != a.total ? (a.rebuild(), !1) : d.target.style && d.target.style.zIndex >= 999999 && d.target.className !== a.guid ? (d.target.style.zIndex = 999998, !1) : void 0 : (a.rebuild(), !1)
        }), c = this.defaultSettings.videoId ? document.getElementById(this.defaultSettings.videoId) : document.getElementsByTagName("body")[0], this.observer.observe(c, {
            attributes: !0,
            attributeOldValue: !0,
            subtree: false,
            characterData: !0,
            attributeFilter: ['width', 'height'],
            characterDataOldValue: !0
        })) : console.warn("您的浏览器版本过低，请及时升级！")
    }, b.rebuild = function () {
        var _this = this;
        this.observer && (this.observer.disconnect(), this.observer = null), document.querySelectorAll("[id^=" + this.guid + "], [class^=" + this.guid + "], [class*=" + this.guid + "]").forEach(function (a) {
            a.parentNode.removeChild(a)
        }), this.init()
    }, a
}();