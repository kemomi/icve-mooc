var leftMenuSpreadFlag=false;var coursewareItemType="";var menuItemId="";var ue=null;var connectionPlay={};$(function(){var b=$("#vp_videoPoint").val();var d=$("#vp_pId").val();var i=$("#vp_itemId").val();if(isStuOrTeacher=="0"){connectionPlay=new $.connectionPlay({courseId:courseId,setItem:function(){var m=$(".s_point.s_pointerct");var n=null;if(m.length>0){n=m.attr("id").substring("s_point_".length)}return n},saveLearningItemTimeStatus:function(){if(coursewareItemType=="video"||coursewareItemType=="courseware"){return false}return true}});if(IsNullEmpty(b)&&IsNullEmpty(d)&&IsNullEmpty(i)){connectionPlay.connParentItem=d;connectionPlay.connItem=i;connectionPlay.connTime=b;$("#courseware_main_menu",parent.document).addClass("learn-menu-cur");$(".learn-menu-cell",parent.document).not($("#courseware_main_menu",parent.document)).removeClass("learn-menu-cur")}}else{if((isStuOrTeacher=="1"||isStuOrTeacher=="3")&&IsNullEmpty(b)){connectionPlay=new $.connectionPlay({courseId:courseId,setItem:function(){return i}});connectionPlay.connParentItem=d;connectionPlay.connItem=i;connectionPlay.connTime=b;$("#courseware_main_menu",parent.document).addClass("learn-menu-cur");$(".learn-menu-cell",parent.document).not($("#courseware_main_menu",parent.document)).removeClass("learn-menu-cur")}}var k=$("#vn_pId").val();var f=$("#vn_itemId").val();var j=$("#vn_postilId").val();if(IsNullEmpty(k)&&IsNullEmpty(f)&&IsNullEmpty(j)){connectionPlay.connParentItem=k;connectionPlay.connItem=f;connectionPlay.connPostilId=j;$("#courseware_main_menu div",parent.document).addClass("s_mainmenucurrent");$(".s_mainmenudiv",parent.document).not($("#courseware_main_menu div",parent.document)).removeClass("s_mainmenucurrent")}if(!CommonUtil.isIpad()){duma.BeautifyScrollBar.init()}else{var a=$(top).height()-100;$(".dumascroll").css({"overflow-y":"scroll",height:a})}$("#s_right").domFix(63);learnslide();$(".s_learnmainmenu").css("visibility","visible").hide();$(".s_learnmainmenu:first").show();nextSectionEvent();noteTileTabBlurEvent();noteAndAnswerbtnEvent();addSaveNoteEvent();initUEditor();$(".s_uev").hide();addSaveAnswerEvent();uploadImgBtn();uploadQsImg();if(isStuOrTeacher=="1"&&fromFlag=="fromFlag"){connectionPlay=new $.connectionPlay({courseId:courseId,setItem:function(){return itemId}});connectionPlay.connParentItem=parentId;connectionPlay.connItem=itemId}var e=$("#learnItemId").val();if((connectionPlay!=null&&IsNullEmpty(connectionPlay.connParentItem)&&IsNullEmpty(connectionPlay.connItem))||CommonUtil.isNotEmpty(e)){var c=connectionPlay.level;var h=connectionPlay.connItem;if(c=="5"){h=connectionPlay.connParentItem}if(CommonUtil.isNotEmpty(e)){h=e}var l=$("#s_point_"+h);l.parents(".s_sectionlist").show();l.parents(".s_sectionwrap").show();var g=l.attr("level");if(!g){l.click()}if(IsNullEmpty(connectionPlay.connPostilId)){connectionPlay.connPostilId=null}}else{setTimeout(function(){$(".s_sectionlist:eq(0)").show();$(".s_sectionwrap:eq(0)").show();$(".s_pointti:eq(0)").click();playFirstNode()},100)}$(window).resize(function(){var m=$(".learn-menu",top.document).attr("canHide");if(m=="yes"){$(".screen-wide",top.document).css({width:"100%"})}});$(".learn-menu",top.document).mouseleave(function(){var m=$(".learn-menu",top.document).attr("canHide");if(m=="yes"){$(".learn-menu",top.document).css("left","-64px")}});$("#learn_menu_layer",top.document).mouseenter(function(){var m=$(".learn-menu",top.document).attr("canHide");if(m=="yes"){$(".learn-menu",top.document).css("left","0px")}});initDefaultTagName()});function IsNullEmpty(a){if(a!=null&&a!=undefined&&a!=""){return true}else{return false}}function learnslide(){$(".s_rightchange").click(function(){var a=$(".s_right_wrap").is(":visible");if(a){$(".s_right_wrap").hide();$(this).addClass("s_rightchange_l").css({left:"300px"});$("#cont_container").removeClass("cont_container")}else{$(".s_right_wrap").show();$(this).removeClass("s_rightchange_l").css({left:"-20px"});$("#cont_container").addClass("cont_container")}})}function numToChineseNum(d){if(!/^\d*(\.\d*)?$/.test(d)){alert("Number is wrong!");return"Number is wrong!"}var g=new Array("0","一","二","三","四","五","六","七","八","九");var h=new Array("","十","百","千","万","亿","点","");var b=(""+d).replace(/(^0*)/g,"").split("."),c=0,f="";for(var e=b[0].length-1;e>=0;e--){switch(c){case 0:f=h[7]+f;break;case 4:if(!new RegExp("0{4}\\d{"+(b[0].length-e-1)+"}$").test(b[0])){f=h[4]+f}break;case 8:f=h[5]+f;h[7]=h[5];c=0;break}if(c%4==2&&b[0].charAt(e+2)!=0&&b[0].charAt(e+1)==0){f=g[0]+f}if(b[0].charAt(e)!=0){if(b[0].length==2&&e==0&&b[0].charAt(e)==1){f=h[c%4]+f}else{f=g[b[0].charAt(e)]+h[c%4]+f}}c++}if(b.length>1){f+=h[6];for(var e=0;e<b[1].length;e++){f+=g[b[1].charAt(e)]}}return f}function getSingleItemCompleteState(c,b){var a=false;$.ajax({url:CommonUtil.getPlatformPath()+"/learn/learnCourseware/getSingleItemCompleteCase.json",data:{"params.courseId":c,"params.itemId":b},dataType:"json",type:"post",async:false,cache:false,success:function(e){if(e&&e.success){var d=e.result;if(d.completed=="1"){a=true}else{a=false}}},error:function(){showAlert("获取节点的完成状态失败")}});return a}var _t=null;function openLearnResItem(l,o,w,C){statisticsLearning();coursewareItemType=o;if(o=="video"||o=="courseware"){$(window.parent.document).find("#showMenus_stype").removeClass("icon-sidefold").addClass("icon-sideunfold");$(window.parent.document).find("#showMenus").show();$(".screen-wide",top.document).css({"padding-left":"0px",width:"100%"});$(".learn-header",top.document).css({"padding-left":"0px"});$(".learn-menu",top.document).css({left:"-64px"}).attr("canHide","yes")}else{$(window.parent.document).find("#showMenus").hide();$(".screen-wide",top.document).css({"padding-left":"64px",width:$(top.window).width()-64});$(".learn-header",top.document).css({"padding-left":"64px"});$(".learn-menu",top.document).css({left:"0px"}).attr("canHide","no")}var v=$("#userType").val();var n=$("#s_point_"+l);var j=$("#currentCourseId").val();if(v=="0"){if(coursewareItemType=="video"){if(l!=menuItemId){menuItemId=l;$("#video_point_time").text("00:00");$("#video_note_point_text").addClass("s_uepc");$(".s_uev").show()}}else{menuItemId=l;$("#video_note_point_text").removeClass("s_uepc");$("#video_point_time").text("00:00");$(".s_uev").hide()}var a=$(".s_point").index(n);var y=$("#prev_item_id").val();var f=null;if(y==""){f=$(".s_point:first");y=f.attr("id").substring("s_point_".length);$("#prev_item_id").val(y)}else{f=$("#s_point_"+y)}if(CommonUtil.isNotEmpty(y)&&f.length>0){var d=f.attr("itemType");var g=f.attr("type");if(g=="courseware"){try{window.frames.mainFrame.coursewareUnload()}catch(A){try{window.frames.mainFrame.contentWindow.coursewareUnload()}catch(A){}}}if(d!="courseware"&&d!="live"){var b=getSingleItemCompleteState(j,y);if(!b){var m=n.offset();$("#item_study_warning").css({top:m.top||0}).show();if(_t!=null){clearTimeout(_t);_t=null}_t=setTimeout(function(){$("#item_study_warning").hide()},2000)}else{f.removeClass("undo_item_bgc").find(".item_done_icon").addClass("done_icon_show");f.attr("completestate","1");if($(".s_point").size()-1==a){n.attr("completestate","1")}}}}}$("#prev_item_id").val(l);var k="";var t=$.getItemObject(o);if(!C){C=t.target}var j=$("#currentCourseId").val();var q=$("#templateStyleType",parent.document).val();var p="";if(v=="0"){p=t.stuUrl}else{p=t.url}k=p;var x=null;if(w){x=n.parent().prev(".s_point").attr("id").substring("s_point_".length)}else{x=n.parent().prev(".s_section").attr("id").substring("s_section_".length)}var s="params.courseId="+j+"&params.itemId="+l+"&params.templateStyleType="+q+"&params.parentId="+x;k=CommonUtil.getPlatformPath()+k+"?"+s;var u=connectionPlay.connItem;if(connectionPlay.level=="5"){u=connectionPlay.connParentItem}if(connectionPlay!=null&&connectionPlay.connTime!=""&&connectionPlay.connTime!=null&&l==u){k+="&params.videoTime="+connectionPlay.connTime+"&params.connItem="+connectionPlay.connItem;connectionPlay.connParentItem=null;connectionPlay.connItem=null}if(connectionPlay!=null&&connectionPlay.connPostilId&&l==u){k+="&params.postilId="+connectionPlay.connPostilId}var c=k+"&_t="+new Date().getTime();openNoCoursewareLayoutRedraw();if(o=="courseware"){isCourseware=true}$("#icon_arrright",top.document).show();var r=$("#isJumping");if(r.length>0){r.val("isJumping")}try{var B=_basePath+"/resource/common/js/plugins/layer-v3.1.0/theme/default/loading-2.gif";var i="<div style='background-color: #f2f2f2;width: 100%;height: 100%;position: absolute;z-index: 100;' id='loading_div'>   <div style='margin: 0 auto;text-align: center;padding-top: 100px;'>       <img style='width: 20px;vertical-align: middle;' src='"+B+"'>&nbsp;&nbsp;加载中...   </div></div>";if(o=="courseware"){$("#mainFrame").find("#scormContent").find("body").html(i)}else{$("#mainFrame").contents().find("body").prepend(i)}}catch(A){$("#mainFrame").attr("src",_basePath+"/learn/learn/templateeight/loading.action")}if(o=="topic"){c+="&params.source=cousrseware"}if(o=="exam"){var h=$(window).height();$("#icon_arrright",top.document).hide();c=_basePath+p+"&"+s+"&params.kckjWinHeight="+h;var z=_basePath+"/learn/learn/templateeight/exam_checkPaperToexam.action?params.url="+c;$("#mainFrame").attr("src",z).focus()}else{if(o=="video"||o=="courseware"){setTimeout(function(){$("#mainFrame").attr("src",c).focus()},200)}else{$("#mainFrame").attr("src",c).focus()}}if(!window.parent.firstIntoThisPage){MultiPageEventBus.emit("gotoLearnHelper",{itemId:l})}}function nextSectionEvent(){$("div.s_left").on("click",".s_lar, .s_rar",function(){var a=$("div[class='s_point s_pointerct']");var g=a.parent("div.s_sectionwrap");var h=g.parent("div.s_sectionlist");var e=a.next();var f=e.prop("id");if(f==null||f=="undefined"||f==""){var b=g.next("div.s_section");var i=b.prop("id");if(i==null||i=="undefined"||i==""){var c=h.next("div.s_chapter");var d=c.prop("id");if(d==null||d=="undefined"||d==""){alert("已经到最后章最后一个节点了！");return false}else{c.nextAll("div.s_sectionlist").find("div.s_sectionwrap").eq(0).find("div.s_point").eq(0).trigger("click")}}else{b.nextAll("div.s_sectionwrap").find("div.s_point").eq(0).trigger("click")}}else{e.trigger("click")}})}function noteTileTabBlurEvent(){$(".s_lnn").blur(function(){if($(this).val()==""){$(this).val("请输入标题")}});$(".s_lnn").focus(function(){if($(this).val()=="请输入标题"){$(this).val("")}hideAlert($(this).prop("id")+"Err")});$(".s_lnnt").blur(function(){if($(this).val()==""){$(this).val("输入新的标签")}});$(".s_lnnt").focus(function(){if($(this).val()=="输入新的标签"){$(this).val("")}hideAlert($(this).prop("id")+"Err")});$("#answerContent").focus(function(){hideAlert($(this).prop("id")+"Err")})}function showAlert(d,b){var a=top.$(window).width();var c=top.$(window).height();if(b){$("#"+b).html(d);$("#"+b).fadeIn()}else{$.messager({content:d,messagerType:"info",cancelButton:false,postion:{left:(a/2-100)+"px",top:(c/2)+"px"}})}}function hideAlert(a){if(a){setTimeout(function(){$("#"+a).fadeOut()},3000)}}function topMenuCls(a){$("#"+a,parent.document).addClass("learn-menu-cur");$(".learn-menu-cell",parent.document).not($("#"+a,parent.document)).removeClass("learn-menu-cur")}function noteAndAnswerbtnEvent(){$(".dumascroll_area").height($(top.window).height()-89);$("#tab_menu, #tab_note, #tab_answer").click(function(){$(".s_learnmainmenu").css("visibility","visible").hide();$(this).addClass("s_sltag_mct").siblings().removeClass("s_sltag_mct");var a=$(this).attr("id").substring("tab_".length);$("div[name='"+a+"_card']").show().siblings(".s_learnmainmenu").hide();initVideoPoint()});$(".s_chapter").click(function(c){var d=$(this);var b=$(this).next(".s_sectionlist");var a=b.is(":hidden");b.slideToggle(function(){rollWindow(c,b,a,d)})});$(".s_section").click(function(c){var d=$(this);var b=$(this).next(".s_sectionwrap");var a=b.is(":hidden");b.slideToggle(function(){rollWindow(c,b,a,d)})});$(".s_point_hassub").click(function(){$(this).toggleClass("collapse");$(this).next().slideToggle()});$(".s_uep").click(function(){$(this).toggleClass("s_uepc");if($(this).hasClass("s_uev")&&$(this).hasClass("s_uepc")){$("#video_point_time").text(getvideoTimeNow())}});$(".s_point").click(function(){$(".s_point").removeClass("s_pointerct");$(this).addClass("s_pointerct");initDefaultTagName()})}function rollWindow(k,i,d,f){var g=k.pageY;var b=$(window).height();var h=b-g;var c=i.height();if(d&&h<c){var l=$("#learnMenu").height();var j=0;var a=true;$("#learnMenu").find("div[name='s_chapter_s']").each(function(){if(f.attr("divindex")==$(this).attr("divindex")){a=false}var e=$(this).is(":hidden");if(a&&!e){j=j+$(this).height()}});$("#dumaScrollAreaId_7Area").animate({scrollTop:j},200)}}function addSaveAnswerEvent(){$("#saveAnswerButton").click(function(){saveQuestion()})}function validQuestion(){var a=true;var b=$("#answerContent").val();if(b.length>1500){showAlert("问题补充字数不能超过1500字！","answerContentErr");a=false}return a}function saveQuestion(){if(!validQuestion()){return}sendAddAnswerRequest()}function sendAddAnswerRequest(){var e=$.trim($("#answerContent").val());if(e==null||e==""||e.length<=0){alert("请输入内容！");return false}e=(!e)?"":e;var f=$("#currentCourseId").val();var d="";var c=$("#uploadShowImg .imgUrl");if(c.length>0){for(var b=0;b<c.length;b++){if(b>0){d+=","}d+=$(c[b]).val()}}$.ajax({url:CommonUtil.getPlatformPath()+"/learn/learnAnswer/saveQuestionInfo.json",data:{body:e,courseId:f,originalImgPaths:d},dataType:"json",type:"post",async:false,cache:false,success:function(a){if(a&&a.success){showAlert("提问成功,可去[大家在说什么]查看提问！")}else{showAlert("提问失败,请联系管理员")}clearAnswerData()},error:function(){showAlert("提问失败,请联系管理员！");clearAnswerData()}})}function clearAnswerData(){$("#answerTitle").val("请输入标题");$("#answerContent").val("");if($(".imageUploader-queue_addQs")){$(".imageUploader-queue_addQs").remove()}$("#uploadShowImg").hide()}function answerDetail(a,b,c){parent.$("#icon_arrright").hide();topMenuCls("answer_main_menu");window.location.href=CommonUtil.getPlatformPath()+"/learn/answer/blue/index.action?params.questionId="+a+"&params.courseId="+b+"&params.opt="+c}function answerMore(a){parent.$("#icon_arrright").hide();topMenuCls("answer_main_menu");$(".screen-wide",top.document).css({"padding-left":"64px",width:$(top.window).width()-64});$(".learn-header",top.document).css({"padding-left":"64px"});$(".learn-menu",top.document).css({left:"0px"}).attr("canHide","no");window.location.href=CommonUtil.getPlatformPath()+"/learn/answer/blue/index.action?params.selected=1&params.courseId="+a+"&params.opt=1"}function uploadImgBtn(){$("#upload_img_btn").on("click",function(){$("#uploadShowImg").slideDown()})}function uploadQsImg(){initWebuploader()}function initWebuploader(){var a=WebUploader.create({auto:true,swf:CommonUtil.getPlatformPath()+"/resource/common/js/plugins/webuploader/Uploader.swf",server:CommonUtil.getPlatformPath()+"/learn/learnCommon/saveUploadFile.json",fileVal:"Filedata",pick:{id:"#upload_img_btn",multiple:true},accept:{title:"Images",extensions:"jpg,png,gif,jpeg,bmp",mimeTypes:"image/*"},fileSizeLimit:2*1024*1024,fileNumLimit:3,duplicate:true});$("#upload_img_btn").find(".webuploader-pick").css({width:"80px",height:"28px","line-height":"28px",padding:"0px"});a.on("fileQueued",function(d){if($("#uploadShowImg .imageUploader-queue_addQs").length>=3){return false}var b="qsImgUpload_"+d.id;var c="";c+="<div class='imageUploader-queue_addQs' id='"+b+"'>";c+="	<div class='pic_addQs'>";c+="		<img src=''/><b class='deleteImg'></b>";c+="	</div>";c+='   <div class="status-wrapper_addQs">';c+='		<div class="status_addQs start-status progress-status success-status">';c+='			<div class="progress-bar_addQs" style="width: 80px;">';c+='     	       <div class="progress-bar-value_addQs" style="width:0%;"></div>';c+="     	    </div>";c+=" 	    </div>";c+="   </div>";c+='   <input type="hidden" name="imgUrl" class="imgUrl" />';c+="</div>";$("#addImgBtn").before(c);if($("#uploadShowImg .imageUploader-queue_addQs").length>=3){$("#uploadShowImg").find("#hiddenUploadBut_add_qs").show()}});a.on("uploadProgress",function(c,b){var d="qsImgUpload_"+c.id;$("#"+d).find(".progress-bar-value_addQs").css("width",(b*100)+"%")});a.on("uploadSuccess",function(f,g){var c=f.id;g=$.parseJSON(g._raw);var h=this;var e=CommonUtil.getPlatformPath()+"/"+g.files[0].link;var b="qsImgUpload_"+c;var d=$("#"+b);d.find(".imgUrl").val(g.files[0].link);d.find(".status-wrapper_addQs").hide();d.find(".pic_addQs img").attr("src",e);$("#uploadShowImg").show();$("#uploadShowImg").find(".pic_addQs img").show();$("#uploadShowImg").find(".pic_addQs img").css("display","block");d.find(".deleteImg").off("click").on("click",function(){var i=$(this).parents(".imageUploader-queue_addQs").attr("id").substring("qsImgUpload_".length);a.cancelFile(i);a.removeFile(i,true);d.remove();deleteUploadImg(this)})});a.on("uploadError",function(b,c){a.removeFile(b,true);a.reset()});a.on("error",function(c,e,d,b){switch(c){case"Q_EXCEED_NUM_LIMIT":alert("文件数量超出限制，最多允许上传"+e+"个文件");break;case"F_EXCEED_SIZE":alert("单个文件大小超出限制，最大为"+CommonUtil.formatFileSize(e,0)+"。不合法文件："+d.name);break;case"Q_EXCEED_SIZE_LIMIT":alert("总文件大小超出限制，最大为"+CommonUtil.formatFileSize(e,0)+"。");break;case"Q_TYPE_DENIED":alert("文件类型不满足。不合法文件："+e.name);break;case"F_DUPLICATE":alert("文件重复："+e.name);break;default:alert("un dealed error:"+c);break}})}function deleteUploadImg(b){var a=$(b).prev("img").attr("src");$.ajax({url:CommonUtil.getPlatformPath()+"/learn/learnAnswer/deleteUploadImg.json",type:"post",data:{imgSrc:a},dataType:"json",cache:false,async:false,success:function(c){},error:function(){alert("请求失败，请联系管理员！")}})}function handleForm(){$("#uploadShowImg  div.imageUploader-queue_addQs").remove();$("#upload_img_btn").show();$("#uploadShowImg").hide()}function noteDetail(d,a,c){parent.$("#icon_arrright").hide();topMenuCls("note_main_menu");var b=CommonUtil.getPlatformPath()+"/learn/note/blue/note_index.action?params.courseId="+a+"&params.opt="+c;window.location.href=b}function noteMore(a){parent.$("#icon_arrright").hide();topMenuCls("note_main_menu");$(".screen-wide",top.document).css({"padding-left":"64px",width:$(top.window).width()-64});$(".learn-header",top.document).css({"padding-left":"64px"});$(".learn-menu",top.document).css({left:"0px"}).attr("canHide","no");window.location.href=CommonUtil.getPlatformPath()+"/learn/note/blue/note_index.action?params.courseId="+a+"&params.opt=0"}function addSaveNoteEvent(){$("#saveNoteButton").click(function(){saveNewNoteData()})}function saveNewNoteData(){$("#saveNoteButton").unbind();if(!validNote()){addSaveNoteEvent();return}var a=getNewNoteInfo();sendAddNoteRequest(a)}function validNote(){var c=30;var a=500;var b=$("#noteTitle");var e=b.val();var d=ue.getContentTxt().trim();if(!d){showAlert("请输入笔记内容！","noteEditorErr");return false}else{if(d.length>a){showAlert("笔记内容不能超过"+a+"字符！","noteEditorErr");return false}}if(!e||e==="请输入标题"){if(d.length>c){b.val(d.substring(0,c))}else{b.val(d)}}else{if(e.length>c){showAlert("标题内容不能超过"+c+"个字符！","noteTitleErr");return false}}return true}function getNewNoteInfo(){var b={};var e=$("#currentCourseId").val();var d=ue.getContent();d=(!d)?"":d;var a=$("#notePrivacy").attr("class");if(a=="s_uep s_uepc"){currentIsPublic="0"}else{currentIsPublic="1"}var g=$("#noteTitle").val();var f=getFinalTagName();b["params.courseId"]=e;b["params.content"]=d;b["params.isPublic"]=currentIsPublic;b["params.title"]=g;b["params.tagNames"]=f;b["params.courseItemId"]=menuItemId;if(!$("#videoNotePoint").is(":hidden")&&$("#videoNotePoint").hasClass("s_uepc")){b["params.flagType"]=1;var c=$("#video_point_time").html();var h=c.split(":");if(h.length>2){c=parseInt(h[0]*60*60)+parseInt(h[1]*60)+parseInt(h[2])}else{c=parseInt(h[0]*60)+parseInt(h[1])}b["params.videoPoint"]=c}return b}function sendAddNoteRequest(a){$.ajax({url:CommonUtil.getPlatformPath()+"/learn/learnNote/saveNote.json",data:a,dataType:"json",type:"post",async:false,cache:false,success:function(b){if(b&&b.success=="1"){showAlert("保存成功")}else{showAlert("保存失败")}addSaveNoteEvent();clearNoteData()},error:function(){showAlert("保存失败!");addSaveNoteEvent();clearNoteData()}})}function clearNoteData(){$("#noteTitle").val("请输入标题");$("#newTagInput").val("输入新的标签");$("#notePrivacy").removeClass();$("#notePrivacy").addClass("s_uep");initUEditor();initDefaultTagName()}function initUEditor(){if(ue==null){ue=UE.getEditor("noteEditor",{toolbars:[["bold","insertorderedlist","justifycenter","justifyjustify","justifyleft","justifyright"]],wordCount:false,elementPathEnabled:false,zIndex:10,maximumWords:10000,initialFrameWidth:277,initialFrameHeight:123,autoHeightEnabled:false});$(".edui-editor").css("border","none");ue.addListener("blur",function(){this.sync("noteEditor")});ue.addListener("focus",function(){hideAlert("noteEditorErr")})}else{ue.execCommand("cleardoc")}}function getFinalTagName(){var c=$("#addTagtb").children(".s_lnntb");var d="";for(var b=0;b<c.length;b++){var a=$(c[b]).prop("title");if(b==0){d+=a}else{d+="|"+a}}return d}function saveNewAddTag(){var c=$.trim($("#newTagInput").val());var b=/<[^>]*>|<\/[^>]*>/gm;var c=c.replace(b,"");if(c==null||c==""||c=="输入新的标签"){showAlert("请输入标签！","newTagInputErr");return}else{if(c!=null&&c.length>10){showAlert("标签不超过10字符！","newTagInputErr");return}else{var a=checkIsAddedSameTag(c);if(a){showAlert("标签已存在","newTagInputErr");return}insertTagName(c);$("#newTagInput").val("输入新的标签")}}}function initDefaultTagName(){var j=$("#show_section_id").val();var d=$("#userType").val();if(d!="0"){return}$("#addTagtb").children().remove();$("#addTagtb").append("<div class='s_lnntb s_add' onclick='javascript:initAddTagBtn();' data-trigger='add-tag'>+</div><div class='clear'></div>");var e=$("#learnMenu").find(".s_pointerct");var g=e.text().trim();g=g.split("：")[0];var h=$(e).parents("div.s_sectionwrap").prev();var b=$(h).parents("div.s_sectionlist").prev();var a=h[0].innerText;var k=b[0].innerText;var i=$(b).attr("title");var c=$(h).attr("title");var f=c.indexOf("：");c=c.substring(f+1).trim();if(i!=null){if(j==="1"){insertTagName(k)}else{insertTagName(i)}}if(c!=null){if(j==="1"){insertTagName(a)}else{insertTagName(c)}}if(g!=null){insertTagName(g)}}function initAddTagBtn(){var d="+";var c="取消";var e=$("[data-trigger=add-tag]");var f=$(".s_lnnt_wrap");e.text(e.text()===d?c:d);f.toggle()}function insertTagName(c){var e=checkIsAddedSameTag(c);if(!e){var b=getLastTagClass();var g=dealTagNameTooLong(c);var f="<div class='"+b+"' title='"+c+"'>"+g+"<div class='s_lnntb_close'></div></div>";$("#addTagtb").find(".s_add:last").before(f);if($("#addTagtb").length==0){return}var a=$("#addTagtb").html();var d=/(\n(?=(\n+)))+/g;var h=a.replace(d,"<div class='s_lnntb s_add' onclick='javascript:initAddTagBtn();' data-trigger='add-tag'>+</div><div class='clear'></div>");$("#addTagtb").html(h);$("#addTagtb").find(".s_lnntb_close").click(function(){$(this).parent("div:first").remove()})}}function checkIsAddedSameTag(e){var d=false;var c=$("#addTagtb").find(".s_lnntb");for(var b=0;b<c.length;b++){var a=$(c[b]).text();if(a==e){return true}}return d}function dealTagNameTooLong(a){a=ltrim(a);if(a.length<=19){return a}else{return a.substring(0,16)+"..."}}function ltrim(a){return a?a.replace(/(^\s*)/g,""):""}function getLastTagClass(){var b=$("#addTagtb").find(".s_lnntb:last").attr("class");var a="s_lnntb s_blue";if(b=="s_lnntb s_blue"){a="s_lnntb s_green"}else{if(b=="s_lnntb s_green"){a="s_lnntb s_orange"}else{if(b=="s_lnntb s_orange"){a="s_lnntb s_pink"}else{if(b=="s_lnntb s_pink"){a="s_lnntb s_purp"}else{a="s_lnntb s_blue"}}}}return a}function getChapterName(){var b=null;b=$("#learnMenu").children(".s_chapter:first").text();var a=b.indexOf("&nbsp;");b=b.substring(a+5);return b}function initVideoPoint(){if(coursewareItemType=="video"){$("#videoNotePoint").addClass("s_uepc");$(".s_uev").show();$("#video_point_time").text(getvideoTimeNow())}}function getvideoTimeNow(){try{var g=null;try{g=window.frames.mainFrame.jwplayer("container").getPosition()}catch(f){g=window.frames.mainFrame.contentWindow.jwplayer("container").getPosition()}if(g==undefined){return"00:00"}var d=parseInt(g);var c=0;var b=0;if(d>60){c=parseInt(d/60);d=parseInt(d%60);if(c>60){b=parseInt(c/60);c=parseInt(c%60)}}if(d<10){d="0"+d}if(c<10){c="0"+c}var a;if(b==0){a=c+":"+d;return a}if(b<10){b="0"+b}a=b+":"+c+":"+d;return a}catch(f){return"00:00"}}function bigScorllShow(){if(isCourseware){return}$("#screen_narrow").toggleClass("screen-narrow-hide");if($("#screen_narrow").hasClass("screen-narrow-hide")){$("#screen_wide_1").css("width","100%")}else{setTimeout(function(){$("#screen_wide_1").width(window.innerWidth-320)},300)}};