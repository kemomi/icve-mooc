var basePath=CommonUtil.getPlatformPath();var userLoginType=$("#userLoginType").val();var courseId=$("#courseId").val();var itemId=$("#itemId").val();var videoResource=$("#videoResource").val();var videoDefinition=$("#video_definition").val();if(resource){videoResource=CommonUtil.getVideoResourceByDefinition(resource,videoDefinition)}var videoTime="00:00:00";var videoJpg=$("#videoJpg").val();var videoOrigin=$("#videoOrigin").val();var captionUrl=$("#captionUrl").val();var video_bullet_config=$("#video_bullet_config").val();var videoSpeed=$("#video_speed").val();var videoSpeedRates=[2,1.5,1,0.75,0.5];var video_trajectory_config=$("#video_trajectory_config").val();var jwplaySeekTimer=null;var transcodeType=$("#transcodeType").val();var maxSeekPosition=0;var maxStudyPosition=parseInt($("#max_study_position").val())||0;var autoPlayConfig=$("#autoPlayConfig",window.parent.document).val();$(function(){document.onmousemove=mouseMove;var r=jwplayer.utils.isIE();if(r){$("#video_bullet_container").remove();$("#bulletControl").remove()}else{$("#video_bullet_container").css({display:"block"});$("#bulletControl").css({visibility:"visible"})}if(videoSpeed=="0"){videoSpeedRates=false}$("#screen_player").width(window.innerWidth);videoPlayerObj.playerName="container";if(video_trajectory_config=="0"){$("#trace_detail").hide()}if(videoJpg==""){videoJpg=null}else{if(videoJpg.indexOf("http://")<0&&videoJpg.indexOf("https://")<0){videoJpg=basePath+"/"+videoJpg}}var e={};var s=window.innerWidth;var g=window.innerHeight;if(isLocal=="0"){e={file:CommonUtil.formatProtocol(videoResource),image:videoJpg,autostart:!window.hasOpeningVideo(),playbackrates:videoSpeedRates,type:"flvlist",primary:"html5",width:s,height:g,controls:false,volume:60}}else{e={file:encodeURI(videoResource),image:videoJpg,autostart:true,playbackrates:videoSpeedRates,primary:"html5",width:s,height:g,controls:false,volume:60}}if(!jwplayer.utils.isIE()){var j=$("#customPlayerUrl").val();if(j&&j!=""){e.servers=[j]}}if(captionUrl!=""&&transcodeType!="1"){e.captions={back:false,color:"ffffff",fontsize:16};e.tracks=[{file:captionUrl,kind:"captions","default":true}]}if(CommonUtil.isNotEmpty(videoDefinition)){if(videoDefinition!="auto"){e.preferlevels=[videoDefinition]}}else{e.preferlevels=["240p"]}var q=null;var b=0;var u=0;var p=false;var d=false;var a=false;var n={};var l=null;var f=[];var m=[];var o="";var t=$("div[name^='dialog_video_ques_']");t.each(function(){var v=$(this).find("input[name='insert_time']").val();if(o!=""&&v&&v!=""){o+="/"}o+=v});if(o!=null&&o!="undefined"&&o!=""){if(o.indexOf("/")>-1){m=o.split("/")}else{m.push(o)}}n.onReady=function(){if(itemId!==l){$.fn.showSkipVideoBeginMsg()}try{initWatermark("container")}catch(w){console.log(w)}initPlayerControls();$("#screen_full_li").show();if(!$("#v_loading_ico").is(":hidden")){$("#v_loading_ico").hide()}var v=setInterval(function(){var x=document.getElementById("container").getElementsByTagName("video")[0];if(x){x.muted=true;clearInterval(v)}},10);try{if(!r&&video_bullet_config=="1"){$.fn.videoBullet({userType:userLoginType,timePoint:u,pause:d,fullscreen:a});$("#slider-opacity").find("a").css({top:"0px"});$("#slider-speed").find("a").css({top:"0px"})}}catch(w){}if(!CommonUtil.isIEBrowserNoIE11()){$("#container").problemFeedBlack({device:"pc",courseId:courseId,itemId:itemId,shutdownBtnId:"pc_shut",isIEFlag:r})}initControlBarEvent("cont")};n.onBuffer=function(v){if(jwplayer("container").getState()=="PLAYING"){videoPlayerObj.videoBufferLock=true}changeBtnStatusToBuffer()};n.onBufferFull=function(v){videoPlayerObj.videoBufferLock=false;$("#definitionTip").hide();if(videoPlayerObj.changeVideoLevelPause){videoPlayerObj.changeVideoLevelPause=false}changeBtnStatusToPlayingOrBufferFull()};n.onPlay=function(){if(!r){d=false}var w=document.getElementById("container").getElementsByTagName("video")[0];if(w&&w.muted===true){w.muted=false}var v=videoPlayerObj.isGetVideoRecord;if(v){videoPlayerObj.isGetVideoRecord=false;addQualityLevels();if(userLoginType=="0"){judgeVideoIsReady()}}changeBtnStatusToPlayingOrBufferFull();if(jwplayer("opening-video-container")!=null){window.hasOpeningVideo()&&this.pause()}if(window.parent.parent.continueStart!=undefined&&window.parent.parent.continueStart){u=this.getPosition();this.pause();window.parent.parent.continueStart=false}};n.onPause=function(){if(!r){d=true;if(d&&video_bullet_config=="1"){try{$.fn.videoBullet({timePoint:u,pause:d,fullscreen:a})}catch(v){}}}changeBtnStatusToPauseOrReplay()};n.onTime=function(){b=jwplayer("container").getDuration();if(b&&b>0){var x=b-u;if(x<=10&&x>9){$.fn.showSkipVideoEndMsg()}if(top.isTimerStop||videoPlayerObj.questionInsertPause){this.pause();return}if(videoPlayerObj.changeVideoLevelPause){videoPlayerObj.changeVideoLevelPause=false}if(jwplayer("container").getState()=="PLAYING"){u=this.getPosition();if(captionUrl!=""&&transcodeType=="1"){updateCurCaptionText(u)}}if(videoPlayerObj.isInitPosProgress){videoPlayerObj.isInitPosProgress=false;connectionPlayAddCompleteDiv(videoPlayerObj.learningVideoTime,"container")}b=parseInt(b);videoTime=CommonUtil.convertTotalSeconds(b);ResourceUtils.updateVideoTotalTime(itemId,videoTime);var B=u/b*100;if(!videoPlayerObj.moveLock){if(B>99.5){B=99.5}if(B<=0.5){B=0.5}$("#pos_btn").css("left",B+"%");$("#pos_btn_width").css("width",B+"%");maxSeekPosition=Math.max(maxSeekPosition,Math.max(u,maxStudyPosition))}var A=videoPlayerObj.startPos||0;$("#"+videoPlayerObj.tempId).css("width",(B-A)+"%");$("#screen_player_time_1").text(CommonUtil.convertTotalSecondsHMS(u));$("#screen_player_time_2").text(CommonUtil.convertTotalSecondsHMS(b));$.fn.videoLearnRecord({playComplete:false,courseId:courseId,itemId:itemId,position:u,videoTotalTime:videoTime});if(q==null){var z=300;if(b<=z){z=parseInt(b*0.8)}q=setInterval(function(){$.fn.videoLearnRecord({interval:true,playComplete:false,courseId:courseId,itemId:itemId,position:u,videoTotalTime:videoTime})},z*1000)}if($("#video_trace_container").is(":hidden")){$("#video_trace_container").show()}if(!r&&video_bullet_config=="1"){$.fn.videoBullet({userType:userLoginType,timePoint:u,pause:d,fullscreen:a})}}if(m&&m.length>0){var w=(u!=null&&u!="undefined")?u.toString().split(".")[0]:0;for(var y=0;y<m.length;y++){if(parseFloat(m[y])-parseFloat(w)==0){this.pause();this.setFullscreen(false);var v=$("div[name='dialog_video_ques_"+w+"']").find("input[name='itemQuestionBean.id']").val();insert_question(v);m.splice(y,1);$("#div_layer_q").show();videoPlayerObj.questionInsertPause=true}}}};n.onComplete=function(){p=true;if(q){clearInterval(q)}if(b&&b>0){var v=this.getPosition();$.fn.videoLearnRecord({playComplete:true,async:false,courseId:courseId,itemId:itemId,position:v,videoTotalTime:videoTime})}window.playEndingAdVideo();autoLearn();changeBtnStatusToPauseOrReplay()};n.onFullscreen=function(w){if(!r&&video_bullet_config=="1"){if(w.fullscreen){a=true}else{a=false}try{$.fn.videoBullet({timePoint:u,pause:d,fullscreen:a})}catch(v){}}};e.events=n;jwplayer("container").setup(e);var h=videoPlayerObj.playerName;if(videoPlayerObj.videoType=="video_video"){h=videoPlayerObj.coursewarePlayerName}jwplayer(h).setVolume(50);if(captionUrl!=""&&transcodeType=="1"){loadVideoCaption(captionUrl)}var c=$(parent.document).find("#vp_videoPoint").val();if(userLoginType=="0"){var k=new $.connectionPlay({courseId:courseId,setItem:function(){if(itemId==null||itemId==""||itemId==undefined){itemId=null}return itemId},setVideoTime:function(){return u}});if(c!=""&&c!=null&&c!=undefined){k.connTime=c;k.connItem=$(parent.document).find("#vp_itemId").val()}var i=parseInt(k.connTime,10);l=k.connItem;if(itemId==k.connItem){if(i>0&&isLocal=="0"){videoPlayerObj.isInitPosProgress=true;videoPlayerObj.learningVideoTime=i;jwplayer("container").seek(i)}else{if(i>0&&isLocal=="1"){jwplaySeekTimer=setInterval(function(){playSeek(i)},200)}}}}if((userLoginType=="1"||userLoginType=="3")&&c!=""&&c!=null&&c!=undefined){var k=new $.connectionPlay({courseId:courseId,setItem:function(){return $(parent.document).find("#vp_itemId").val()},setVideoTime:function(){return c}});k.connTime=c;k.connItem=$(parent.document).find("#vp_itemId").val();var i=parseInt(k.connTime,10);if(itemId==k.connItem){if(i>0&&isLocal=="0"){jwplayer("container").seek(i)}else{if(i>0&&isLocal=="1"){jwplaySeekTimer=setInterval(function(){playSeek(i)},200)}}}}$(parent.document).find("#vp_videoPoint").val("");$(parent.document).find("#vp_pId").val("");$(parent.document).find("#vp_itemId").val("");questionInsertInitBtn();videoPlayerObj.videoType="video";$(window).unload(function(){if(!p&&b&&b>0&&videoTime!="00:00:00"){$.fn.videoLearnRecord({unloadVideoPage:true,async:false,courseId:courseId,itemId:itemId,position:u,videoTotalTime:videoTime})}});$(window).resize(function(){var v=window.innerWidth;var w=window.innerHeight;$("#container").width(v);$("#container").height(w);$("#video_bullet_container").width(v);$("#video_bullet_container").height(w);$("#screen_player").width(window.innerWidth);setTimeout(function(){btnResize()},10)});btnResize();tipShowOrHide();$("#bullet_recordList_1").mCustomScrollbar();$(window).focus();$("html body",parent.document).attr("style","background: #ffffff")});function autoLearn(){if(jwplayer("ending-video-container")==null){if(autoPlayConfig==="1"){if($("#screen_full").find(".icon-restore-stroke").length>0){$("#screen_full").click()}if(typeof(window.parent.exePlayNextNode)=="function"){window.parent.exePlayNextNode(itemId)}}}else{setTimeout(autoLearn,800)}}function playSeek(a){var c=jwplayer("container").getState();if(c!=undefined&&c.toLocaleUpperCase()=="PLAYING"){jwplayer("container").seek(a);var b=jwplayer("container").getPosition();if(b>0&&jwplaySeekTimer!=null){clearInterval(jwplaySeekTimer)}}}function questionInsert(){$(".popup-content-in").mCustomScrollbar({scrollbarPosition:"outside",theme:"my-theme"})}function btnResize(){var f=$("#container").height();if(f==null||f==undefined||f==""){f=$("body").height()}var a=$("body").width();var b=$("#player_pause").width();var e=$("#player_pause").height();$("#player_pause").css({top:(f-e)/2,left:(a-b)/2});var d=$("#v_loading_ico").width();var c=$("#v_loading_ico").height();$("#v_loading_ico").css({top:(f-c)/2,left:(a-d)/2})}function tipShowOrHide(){$("#shutdown").click(function(){$("#definitionTip").hide()})}function mouseMove(e){e=e||window.event;var b=mouseCoords(e);var c=b.x;var a=e.pageY;var d=$(window).height()-a;var g=$(".learn-menu",top.document).attr("canHide");var f=parseInt($(".learn-menu",top.document).css("left"));if(g=="yes"){if(f<0&&c<10&&d>120){$(".learn-menu",top.document).css("left",0)}else{$(".learn-menu",top.document).css("left",-64)}}}function mouseCoords(a){if(a.pageX){return{x:a.pageX}}return{x:a.clientX+document.body.scrollLeft-document.body.clientLeft}};