(function(c){var a=false;c.fn.problemFeedBlack=function(d){d=c.extend({},c.fn.problemFeedBlack.defaults,d||{});if(!d.isIEFlag){var f=c("#feedback_div").html();c("#feedback_div").remove();c("#container").append(f)}else{if(d.templateNum==1){c("#video-feedback-btn").css({top:"60px"})}c("#"+d.feedbackBtnId).remove()}b.proEvent(d);if(d.device=="pc"){setInterval(function(){b.windStyleSize(d)},100);if(!d.isIEFlag){c("#"+d.feedbackBtnId).show()}}if(d.device=="weixin"){var g=c("#container").height();var e=c("#container").width();c("#video-feedback-btn").css({top:(g/2+31)+"px",left:(e/2+40)+"px"});c("#open_play_feed_1").css({top:_height/2+30+"px",left:_width/2-50+"px"})}if(d.device!="app"){b.listener(d)}};var b={saveProblem:function(d,f,e){if(d.itemId==""&&c("#itemId").length>0){d.itemId=c("#itemId").val()}c.ajax({url:_basePath+"/problem/feedback/problemFeedBack_saveProblem.action",type:"post",data:{"peProblemFeedback.peTchCourse.id":d.courseId,"peProblemFeedback.scormCourseItem.id":d.itemId,"peProblemFeedback.content":f,contentCheckBox:e},dataType:"json",success:function(g){if(!g.success){alert(g.info);return}b.showSaveMsg(d)},error:function(g){alert("反馈请求失败！")}})},pcShow:function(d){var e=jwplayer("container").getState();if(e!=undefined&&e.toLocaleUpperCase()!="PAUSED"){jwplayer("container").pause()}c("#"+d.itemLiBtn).find('input[type="checkbox"]').prop("checked",false).attr("checked_s",false);c("#"+d.itemLiBtn).find("label").removeClass("active");c("#feedback-popup").show();c("#"+d.feedbackBtnId).hide()},appShow:function(n){c("#mask").hide();c("#feedback-fun-pullup").hide();var m=api.require("WTYVideoPlayerKit");m.pause();var k=api.frameWidth;var g=api.frameHeight;var f=k*9/16;c("#feedback-pullup").show().css({top:(topHeight()+f)+"px",height:(g-f)+"px"});if(n.itemId==""&&c("#itemId").length>0){n.itemId=c("#itemId").val()}var d=_serverPath+"/learn/weixin/common/feedback/appProblemFeedBack.action?params.courseId="+n.courseId+"&params.itemId="+n.itemId;try{var l=api.frameWidth;var j=topHeight();var i=g-j;appOpenFrame("feedback",d,k,i,"0",j<0?0:j)}catch(h){}b.appLevel();c("#form-textarea-num-leve").text(0+"/100");c("#form-textarea-num").text(0+"/100")},appLevel:function(){window.addEventListener("orientationchange",function(){var d=Math.abs(window.orientation);if(d==90){appCloseFrame("feedback")}})},html5Show:function(d){c("#"+d.itemLiBtn).find('li[name="feedback-label"]').attr("checked",false).removeAttr("checked_s");c("#"+d.itemLiBtn).find("span").removeClass("feedback-label_active");c("#mask").hide();c("#feedback-textarea").hide();c("#header-vary").hide();c("#feedback-fun-pullup").hide();c("#feedback-pullup").show().css("top","0px");c("#other_feedback").val("");c("#"+d.itemLiBtn).find('label[name="feedback-label"]').each(function(){c(this).attr("checked",false);c(this).attr("checked_s",false);c(this).removeClass("feedback-label_active");c(this).find("i").removeClass("icon-selected")});setTimeout(function(){c("#feedback_btn_foot").show()},200);b.html5Level();c("#"+d.toolsId).hide();b.updateHtml5View();c("#other_feedback").off("focus").focus(function(){setTimeout(function(){c("#feedback_btn_foot").hide();var g=Math.abs(window.orientation);if(g==90){c("#feedback_interact").show();var e=c(window).width()-110;c("#level_dark_c").width(e);var f=c("#other_feedback").val();c("#other_feedback_level").val(f).focus()}},100)});c("#other_feedback").off("blur").blur(function(){setTimeout(function(){c("#feedback_btn_foot").show()},100)});c("#level_input").off("click").click(function(){c("#feedback_interact").hide();var e=c("#other_feedback_level").val();c("#other_feedback").val(e)});c(window).resize(function(){var e=c(window).height();var f=Math.abs(window.orientation);if(f==0){if(e==d.winHeight){c("#feedback_btn_foot").show()}else{c("#feedback_btn_foot").hide()}}});c("#form-textarea-num-leve").text(0+"/100");c("#form-textarea-num").text(0+"/100")},html5Level:function(){window.addEventListener("orientationchange",function(){b.updateHtml5View()})},updateHtml5View:function(){var d=Math.abs(window.orientation);if(d==90){c("#feedback-items").find("label[name='feedback-label']").addClass("level_label");c("#feedback_btn_foot").addClass("level_foot");c("#space-feedback-container").addClass("level_container");setTimeout(function(){var e=c(window).height()-100;c("#space-feedback-container").height(e);c("#other_feedback").blur();c("#other_feedback_level").blur()},100)}else{c("#feedback-items").find("label[name='feedback-label']").removeClass("level_label");c("#feedback_btn_foot").removeClass("level_foot");c("#space-feedback-container").removeClass("level_container");setTimeout(function(){c("#space-feedback-container").removeAttr("style")},100);if(!c("#feedback_interact").is(":hidden")){c("#level_input").click()}}},proEvent:function(d){c("#"+d.feedbackBtnId+", #"+d.feedbackBtnId+"_1").click(function(f){c("#other_feedback").val("");f.stopPropagation();if(d.device=="pc"){b.pcShow(d);return}if(d.device=="app"){b.appShow(d);return}if(d.device=="weixin"){b.html5Show(d);return}});c("#"+d.shutdownBtnId).click(function(f){f.stopPropagation();if(d.device=="pc"){c("#feedback-popup").hide();c("#"+d.feedbackBtnId).show();var g=jwplayer("container").getState();if(g!=undefined&&g.toLocaleUpperCase()!="PLAYING"){jwplayer("container").play(true)}return}if(d.device=="app"){appCloseFrame("feedback");return}c("#"+d.toolsId).show();c("#header-vary").show();c("#feedback-pullup").css("top","100%");c("#feedback_btn_foot").hide()});c("#feedback-popup").click(function(f){f.stopPropagation()});c("#"+d.submitBtnId).click(function(f){f.stopPropagation();if(d.device=="pc"){b.savePcContent(d);return}b.saveMobileContent(d)});if(d.device=="pc"){c("#"+d.itemLiBtn).on("click",'input[type="checkbox"]',function(f){f.stopPropagation();if(c(this).attr("checked_s")&&c(this).attr("checked_s")=="true"){c(this).attr("checked",false);c(this).attr("checked_s",false);c(this).closest("label").removeClass("active")}else{c(this).attr("checked",true);c(this).attr("checked_s",true);c(this).closest("label").addClass("active")}})}else{var e="click";if(d.device=="app"){e="touchstart"}c("#"+d.itemLiBtn).on(e,'label[name="feedback-label"]',function(f){if(c(f.target).is("input")){return}if(c(this).attr("checked_s")&&c(this).attr("checked_s")=="true"){c(this).attr("checked",false);c(this).attr("checked_s",false);c(this).removeClass("feedback-label_active");c(this).find("i").removeClass("icon-selected")}else{c(this).attr("checked",true);c(this).attr("checked_s",true);c(this).addClass("feedback-label_active");c(this).find("i").addClass("icon-selected")}var g=c(this).attr("id");if(c("#feedback-textarea").is(":hidden")&&g==="feedback-advice"){c("#feedback-textarea").show()}else{if(!c("#feedback-textarea").is(":hidden")&&g==="feedback-advice"){c("#feedback-textarea").hide()}}});if(d.device=="app"){c("#feedback_tool").show()}c("#feedback_tool").click(function(f){if(d.device=="app"){b.appShow(d);return}});c("#other_feedback").on("input propertychange",function(){var f=c(this).val().length;c("#form-textarea-num-leve").text(f+"/100");c("#form-textarea-num").text(f+"/100")});c("#other_feedback_level").on("input propertychange",function(){var f=c(this).val().length;c("#form-textarea-num-leve").text(f+"/100");c("#form-textarea-num").text(f+"/100")})}},savePcContent:function(e){var g=c("#feedback-items").find("input:checked");var i=[];c(g).each(function(){var j=c(this).parent().text().trim();i.push(j)});var h=i.join("，");var d=c("#other_feedback").val().trim();if(d!=""&&h!=""){h=h+"，"+d}else{if(d!=""){h=d}}if(h==""){alert("内容不能为空");return}var f=d.replace(/[^\x00-\xff]/g,"1").length;if(f.length>100){alert("内容不能超过100个字符");return}b.saveProblem(e,h,i.join("，"))},saveMobileContent:function(d){var f=c("#feedback-items").find("label[checked='checked']");var h=[];c(f).each(function(){if(c(this).attr("id")!="feedback-advice"){var i=c(this).text().trim();h.push(i)}});var g=h.join("，");if(!c("#feedback-textarea").is(":hidden")){if(g==""){g=c("#other_feedback").val().trim()}else{g=g+"，"+c("#other_feedback").val().trim()}}if(g==""){b.showMsg(d,"内容不能为空");return}var e=g.replace(/[^\x00-\xff]/g,"1").length;if(e.length>100){b.showMsg(d,"内容不能超过100个字符");return}b.saveProblem(d,g,h.join("，"))},showMsg:function(d,e,f){if(d.device=="app"&&f){api.execScript({name:"learnspace",script:"showFeedBackMsg();"});return}if(typeof(e)=="undefined"){e="感谢您的反馈~"}c("#feedback-hint").text(e).fadeIn();setTimeout(function(){c("#feedback-hint").fadeOut()},2000)},showSaveMsg:function(d){d.isClearTimer=true;c("#"+d.feedbackBtnId+"_1").remove();if(d.device=="app"){b.showMsg(d,"感谢您的反馈~",true);c("#"+d.shutdownBtnId).click();return}c("#"+d.shutdownBtnId).click();c("#"+d.feedbackBtnId).show();if(d.device=="pc"){c("#feedback-popup").hide();var e=jwplayer("container").getState();if(e!=undefined&&e.toLocaleUpperCase()!="PLAYING"){jwplayer("container").play(true)}b.showMsg(d);return}c("#header-vary").show();var e=jwplayer("container").getState();if(e!=undefined&&e.toLocaleUpperCase()!="PLAYING"){jwplayer("container").play(true)}b.showMsg(d)},windStyleSize:function(g){var f=c("#container").width();var h=c("#container").height();var e=f/2;var d=h/2;c("#"+g.feedbackBtnId).css({right:"10px"});c("#feedback-hint").css({top:(d+74)+"px",left:e+"px"});c("#feedback-popup").css({top:(d-191)+"px",left:e+"px"});c("#"+g.feedbackBtnId+"_1").css({left:(e-50)+"px"})},winTimer:function(d){setTimeout(function(){var e=jwplayer(d.curEleId).getState();if(e!=undefined&&e.toLocaleUpperCase()=="BUFFERING"){c("#"+d.feedbackBtnId+"_1").show()}a=false},d.intervalTime*1000)},listener:function(d){var e=setInterval(function(){if(jwplayer(d.curEleId)==null){return}var f=jwplayer(d.curEleId).getState();if(f!=undefined&&f.toLocaleUpperCase()=="BUFFERING"){a=true;b.winTimer(d)}if(d.isClearTimer){window.clearInterval(e)}if(f=="PLAYING"){c("#"+d.feedbackBtnId+"_1").hide()}},500)}};c.fn.problemFeedBlack.defaults={intervalTime:5,device:"pc",feedbackBtnId:"video-feedback-btn",shutdownBtnId:"moocwechat",toolsId:"html5_tools",curEleId:"container",submitBtnId:"feedback_btn",courseId:"",itemId:"",itemLiBtn:"feedback-items",isIEFlag:false,templateNum:0,winHeight:c(window).height()}})(jQuery);