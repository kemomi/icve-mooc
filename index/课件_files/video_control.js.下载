var videoPlayerObj={isGetVideoRecord:true,smapleIndex:1,startPos:0,rePaintMaxNum:100,isInitPosProgress:false,getVideoRecordComplete:false,videoRecordIsNull:false,volumeMoveLock:false,tempId:"sample_0",playerName:"",moveLock:false,videoPoint:[],videoPointImages:[],videoBufferLock:false,questionInsertPause:false,changeVideoLevelPause:false,volumeMoveValue:""};var playerKernelType=null;function initPlayerControls(){$(document).on("click","#container, #player_pause_btn, #player_pause",function(d){var b=$(this).attr("id");var c=videoPlayerObj.playerName;var f=jwplayer.utils.isIE();if(f&&b=="player_pause"&&c!="container"){return}if(jwplayer(c).getState()=="PAUSED"){jwplayer(c).play();videoPlayerObj.videoBufferLock=false;return}if(jwplayer(c).getState()=="PLAYING"){jwplayer(c).pause();return}if(jwplayer(c).getState()=="IDLE"){jwplayer(c).play();if(userLoginType=="0"){judgeVideoIsReady()}return}});$(window).keydown(function(d){if(d.keyCode==32){if($("#bullet_postInput").length>0){var b=$("#bullet_postInput").attr("bullet_input");if(b=="true"){return}}var c=videoPlayerObj.playerName;if(jwplayer(c).getState()=="PAUSED"){jwplayer(c).play();videoPlayerObj.videoBufferLock=false;return}if(jwplayer(c).getState()=="PLAYING"){jwplayer(c).pause();return}}});if(userLoginType!="0"){$("#pos_btn_width").css("visibility","visible")}moveCurPost();volumeMoveActionInit();try{questionInsert()}catch(a){}$(window).focus();addQualityLevels()}function moveCurPost(){$("body").on("mousemove",function(c){if(!videoPlayerObj.moveLock){return}var b=c.clientX;$("#pos_btn").css("left",b+"px");$("#pos_btn_width").css("width",b+"px")});$("#pos_btn").on("mousedown",function(b){videoPlayerObj.moveLock=true});$("body").on("mouseup mouseleave",function(e){var b=e.clientX;if(videoPlayerObj.moveLock){var c=jwplayer(videoPlayerObj.playerName);var f=CommonPlayerUtil.timeToCssPosition(maxSeekPosition,c);if(playerKernelType==null){playerKernelType=CommonUtil.getPlayerType("container")}var d=$("#screen_player").width();if(b>d){var g=$("#pos_btn_width").width();b=Math.min(g,d)}if(playerKernelType==="H5"&&userLoginType==="0"&&forbidSeek&&b>f){$.fn.playerMsg({msg:"当前视频不允许快进哟~",containerId:"container"});b=f}seekTimeAction(b);videoPlayerObj.courswareLock=true;setControlBarStatus("normal")}videoPlayerObj.moveLock=false;videoPlayerObj.volumeMoveLock=false});$("#progress-horizontal").on("mousedown",function(c){var b=c.clientX;$("#pos_btn_width").css("width",b+"px");$("#pos_btn").css("left",b+"px");videoPlayerObj.moveLock=true;setControlBarStatus("always")});$("#screen_full").click(function(){var b=$(this).find("i")[0];if($(b).hasClass("icon-restore-stroke")){exitFullScreenMode()}else{intoFullScreenMode("cont")}});try{listeners()}catch(a){}$("#li_definition").on("click","li[name='definition']",function(){if(videoPlayerObj.changeVideoLevelPause){return}videoPlayerObj.changeVideoLevelPause=true;var d=videoPlayerObj.playerName;$("#li_definition").find("a").removeClass("cur-data");$(this).find("a").addClass("cur-data");var c=$(this).attr("definitionval");jwplayer(d).setCurrentQuality(parseInt(c));var e=jwplayer(d).getQualityLevels();var b=e[c].label;$("#li_definition_cur").text(b);$("#li_definition_cur").show();$("#tipValue").html("["+b+"]");$("#definitionTip").show()});if($("#li_speed").length>0){$("#li_speed").on("click","li[name='speed']",function(){setPlaybackRate($(this))})}$(".screen-player-volume .screen-player-btn").click(function(){var b=videoPlayerObj.playerName;var d=parseInt(jwplayer(b).getVolume())===0;var h=$("#player_progress_volume #progress-vertical .ui-state-default"),c=$("#player_progress_volume #progress-vertical .ui-slider-range-min"),f=$(".screen-player-volume .screen-player-btn #volumeIcon");d?(videoPlayerObj.volumeMoveValue!=0?jwplayer(b).setVolume(videoPlayerObj.volumeMoveValue):jwplayer(b).setVolume(50)):jwplayer(b).setVolume(0);var e=d?(videoPlayerObj.volumeMoveValue!=0?videoPlayerObj.volumeMoveValue:"50"):"0";var g=d?"coursespace icon-vol-fill screen-player-btn-icon":"coursespace icon-mute screen-player-btn-icon";h.css("bottom",e+"%");c.css("height",e+"%");f.attr("class",g)})}function setPlaybackRate(c){$("#li_speed").find("a").removeClass("cur-data");c.find("a").addClass("cur-data");var b=c.attr("speedval");var a=videoPlayerObj.playerName;if(videoPlayerObj.videoType=="video_video"){a=videoPlayerObj.coursewarePlayerName}jwplayer(a).setPlaybackRate(b);$("#li_speedval_cur").text(c.find("a").text())}function seekTimeAction(h){var i=document.getElementById("pos_btn_width").clientWidth;var b=$("#screen_player").width();if(i>b){i=b;$("#pos_btn_width").width(b)}var c=!CommonUtil.isEmptyValue(h)&&i>=h?h:i;var g=c/b;var d=jwplayer(videoPlayerObj.playerName).getDuration();var j=parseInt(d);var a=j*g;if(userLoginType==="0"){addOneCompleteDiv(h)}jwplayer(videoPlayerObj.playerName).seek(a);try{controlVideoPlay()}catch(f){}}function addOneCompleteDiv(b){videoPlayerObj.videoBufferLock=true;if(!b){videoPlayerObj.rePaintMaxNum=0;videoPlayerObj.smapleIndex=2}var g=videoPlayerObj.rePaintMaxNum;g=g+1;videoPlayerObj.rePaintMaxNum=g;var a=$("#trace_done_sample").html();var f=videoPlayerObj.smapleIndex;var c="sample_"+f;a=a.replace("sample_id",c);videoPlayerObj.smapleIndex=f+1;$("#trace_pro_p").append(a);videoPlayerObj.tempId=c;var e=b?b:$("#pos_btn_width").width();var h=$("#screen_player").width();var d=e/h;if(d<0.01){d=0}$("#"+c).css({left:(d*100)+"%",width:"0px"});videoPlayerObj.startPos=(d*100)}function connectionPlayAddCompleteDiv(b,c){var h=parseInt(videoPlayerObj.rePaintMaxNum)+1;videoPlayerObj.rePaintMaxNum=h;var a=$("#trace_done_sample").html()||'<div class="trace_done" name="progress_t" style="left: 0%; width: 0%;z-index: 100;" id="sample_1"></div>';var g=videoPlayerObj.smapleIndex;var d="sample_"+g;a=a.replace("sample_id",d);videoPlayerObj.smapleIndex=g+1;$("#trace_pro_p").append(a);videoPlayerObj.tempId=d;var f=jwplayer(videoPlayerObj.playerName).getDuration();var e=b/f;$("#"+d).css({left:(e*100)+"%",width:"0px"});videoPlayerObj.startPos=(e*100)}function volumeMoveActionInit(){var d=$("#player_progress_volume #progress-vertical .ui-state-default"),b=$("#player_progress_volume #progress-vertical .ui-slider-range-min"),c=$(".screen-player-volume .screen-player-btn #volumeIcon");$("#progress-vertical").slider({value:60,orientation:"vertical",range:"min",animate:true,slide:function(f,g){var e=videoPlayerObj.playerName;if(videoPlayerObj.videoType=="video_video"){e=videoPlayerObj.coursewarePlayerName}jwplayer(e).setVolume(g.value);videoPlayerObj.volumeMoveValue=jwplayer(e).getVolume();var h=parseInt(jwplayer(e).getVolume())===0?"0":videoPlayerObj.volumeMoveValue,i=parseInt(jwplayer(e).getVolume())===0?"coursespace icon-mute screen-player-btn-icon":"coursespace icon-vol-fill screen-player-btn-icon";d.css("bottom",h+"%");b.css("height",h+"%");c.attr("class",i)}});var a=videoPlayerObj.playerName;if(videoPlayerObj.videoType=="video_video"){a=videoPlayerObj.coursewarePlayerName}jwplayer(a).setVolume(50);videoPlayerObj.volumeMoveValue="50"}function showVideoPoint(){var a=videoPlayerObj.videoPoint;var b=$("#progress-horizontal").width();var f=jwplayer(videoPlayerObj.playerName).getDuration();if(a&&a.length>0){for(var g in a){var c=a[g].time;var m=a[g].title;var h=c/f;var d=h*100;var n="<div name='"+m+"' class='progress-dot showTip' style='left: "+d+"%;'><span></span></div>";$("#progress-horizontal").prepend(n)}}var l=videoPlayerObj.videoPointImages;if(l&&l.length>0){for(var e in l){var c=l[e].time;var m=l[e].title;var j=l[e].slideimage;var h=c/f;var d=h*100;var n="<div data-imgsrc='"+j+"' name='"+m+"' class='progress-dot showTip' style='left: "+d+"%;'><span></span></div>";$("#progress-horizontal").prepend(n)}}showTip(".showTip")}function changeBtnStatusToBuffer(){if(!$("#player_pause").is(":hidden")){$("#player_pause").hide()}if($("#player_pause_btn").find("i").hasClass("icon-pause-sp-fill")){$("#player_pause_btn").find("i").addClass("icon-play-sp-fill").removeClass("icon-pause-sp-fill")}if($("#v_loading_ico").is(":hidden")){$("#v_loading_ico").show()}}function changeBtnStatusToPlayingOrBufferFull(){if(!$("#player_pause").is(":hidden")){$("#player_pause").hide()}if($("#player_pause_btn").find("i").hasClass("icon-play-sp-fill")){$("#player_pause_btn").find("i").addClass("icon-pause-sp-fill").removeClass("icon-play-sp-fill")}if(!$("#v_loading_ico").is(":hidden")){$("#v_loading_ico").hide()}if(!$("#definitionTip").is(":hidden")){$("#definitionTip").hide()}}function changeBtnStatusToPauseOrReplay(){if($("#player_pause").is(":hidden")){$("#player_pause").show()}if($("#player_pause_btn").find("i").hasClass("icon-pause-sp-fill")){$("#player_pause_btn").find("i").addClass("icon-play-sp-fill").removeClass("icon-pause-sp-fill")}if(!$("#v_loading_ico").is(":hidden")){$("#v_loading_ico").hide()}}function showTip(a){$(a).each(function(){var b=$('<span class="tooltip"><span class="tooltip-thumb"><img src=""></span><span class="tooltip-txt"></span></span>');$(this).on("mouseover",function(){var d=$(this).attr("name");var c=$(this).attr("data-imgSrc");$("body").append(b);b.children("span:last-child").html(d);if(c===undefined){b.children("span:first-child").hide()}else{b.find("img").attr("src",c)}var i=$(this).offset().left;var k=$(this).offset().top;var j=$(this).outerWidth(true);var l=b.outerHeight(true);var h=b.outerWidth();var f=i+(j-h)/2;var e=k-l;if(f<0){f=0}var g=$("#screen_player").width()-(h/2)-75;if(f>g){f=g}b.css({left:f+"px",top:e+"px"})}).on("mouseleave",function(){b.remove()})})}function addQualityLevels(){if(typeof(videoResource)=="undefined"){return}if(videoResource.indexOf("VIDEOSEGMENTS/meta.json")<0){addAliQualityLevels(videoResource);return}$("#li_definition_ul").html("");var g=jwplayer(videoPlayerObj.playerName).getQualityLevels();if(!g){return}if(g.length==1&&g[0].label==0){$("#li_definition").parents("li[class='screen-player-cell']").remove();return}var e=jwplayer(videoPlayerObj.playerName).getCurrentQuality();jwplayer(videoPlayerObj.playerName).setCurrentQuality(parseInt(e));for(var b in g){var a=g[b];var c=a.label;var f="";f=c.replace("P","");if(c=="音频"){break}var d="";if(b==e){d="cur-data";$("#li_definition_cur").text(c);$("#li_definition_cur").show()}$("#li_definition_ul").append('<li class="choose-items-cell" name="definition" definitionval="'+b+'"><a href="javascript:;" class="link-light '+d+' ">'+c+"</a></li>")}}function addAliQualityLevels(i){var c=null;try{c=JSON.parse(i)}catch(h){}if(c==null){return}$("#li_definition_ul").html("");var g=0;var f="";for(var a in c){var b=getDefinitionTest(a);var d="";if(g==0){d="cur-data";f=b}$("#li_definition_ul").append('<li class="choose-items-cell" onclick="reloadPlayer(this)" vkey="'+a+'"><a href="javascript:void(0);" class="link-light '+d+'">'+b+"</a></li>");g+=1}if(g==0){$("#li_definition").parents("li[class='screen-player-cell']").remove()}$("#li_definition_cur").text(f)}function getDefinitionTest(b){var a="";switch(b){case"FD":a="流畅";break;case"LD":a="标清";break;case"SD":a="高清";break;case"HD":a="超清";break;case"FHD":a="全高清";break;case"OD":a="原画";break;case"2K":a="2K";break;case"4K":a="4K"}return a}function reloadPlayer(b){$("#li_definition").find(".cur-data").removeClass("cur-data");var a=$(b).attr("vkey");$(b).find("a").addClass("cur-data");$("#li_definition_cur").text($(b).text());jwplayer(videoPlayerObj.playerName).setCurrentQuality(a)}function timeToCssPosition(c){if(!c){return 0}var b=$("#progress-horizontal").width();var e=jwplayer(videoPlayerObj.playerName).getDuration();var d=parseInt(e);var a=Math.min(c,d);return parseInt(c/d*b)};